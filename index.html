<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alex MacMillan | Employment Law Barrister</title>
    <meta name="description" content="The professional website for Alex MacMillan, a UK-based employment law barrister.">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Alex MacMillan | Employment Law Barrister">
    
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <style>
        /* CORE VARIABLES & RESET */
        :root { --bg-color: #F2F2F0; --panel-bg: #FFFFFF; --text-main: #111111; --text-muted: #555555; --line-color: #D1D1D1; --sidebar-width: 320px; --font-sans: 'Inter', sans-serif; --font-mono: 'Space Grotesk', monospace; --font-serif: 'DM Serif Display', serif; }
        body { font-family: var(--font-sans); background-color: var(--bg-color); color: var(--text-main); margin: 0; line-height: 1.5; -webkit-font-smoothing: antialiased; }
        
        /* LAYOUT */
        .site-wrapper { display: flex; min-height: 100vh; }
        .sidebar { width: var(--sidebar-width); background-color: var(--bg-color); border-right: 1px solid var(--line-color); position: fixed; height: 100vh; padding: 2.5rem; display: flex; flex-direction: column; justify-content: space-between; top: 0; left: 0; overflow-y: auto; z-index: 100; transition: transform 0.3s ease; }
        .main-content { margin-left: var(--sidebar-width); width: calc(100% - var(--sidebar-width)); background-color: var(--panel-bg); min-height: 100vh; }
        
        /* TYPOGRAPHY */
        h1, h2, h3 { font-family: var(--font-serif); color: var(--text-main); font-weight: 400; margin-top: 0; }
        h1 { font-size: 2.5rem; line-height: 1.1; margin-bottom: 0.5rem; }
        h2 { font-size: 3rem; border-bottom: 1px solid var(--line-color); padding-bottom: 1.5rem; margin-bottom: 2rem; }
        .subtitle { font-family: var(--font-mono); font-size: 0.85rem; letter-spacing: 0.05em; text-transform: uppercase; color: var(--text-muted); display: block; margin-bottom: 2rem; }
        p { font-size: 1.05rem; color: #333; max-width: 700px; margin-bottom: 1.5rem; }

        /* NAVIGATION */
        .nav-label { font-family: var(--font-mono); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: #888; margin-bottom: 1rem; display: block; cursor: pointer; }
        .sidebar-nav a { display: block; font-family: var(--font-sans); font-size: 1rem; text-decoration: none; color: var(--text-muted); padding: 0.5rem 0; transition: 0.3s; cursor: pointer; }
        .sidebar-nav a:hover, .sidebar-nav a.nav-active { color: var(--text-main); font-weight: 500; border-bottom: 1px solid var(--text-main); display: inline-block; }

        /* CASES & TIMELINE */
        .case-timeline { position: relative; margin-top: 2rem; padding-left: 1.5rem; }
        .case-timeline::before { content: ""; position: absolute; left: 14px; top: 0; bottom: 0; width: 1px; background: var(--line-color); }
        .case-item { position: relative; margin-left: 1.5rem; padding: 1.75rem 0 1.75rem 1.75rem; border-bottom: 1px solid var(--line-color); }
        .case-item--featured { background-color: #FAFAFA; border-radius: 8px; border: 1px solid #E0E0E0; padding: 2rem 1.75rem; margin-bottom: 1rem; margin-left: 1.5rem; }
        .case-node { position: absolute; left: -2.25rem; top: 2.2rem; width: 12px; height: 12px; border-radius: 999px; background: #FFFFFF; border: 2px solid var(--text-main); z-index: 10; }
        .case-item--featured .case-node { background-color: var(--text-main); }
        .case-year-label { position: absolute; left: -4.5rem; top: 1.85rem; font-family: var(--font-mono); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-muted); }
        
        .case-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 1.5rem; margin-bottom: 0.5rem; flex-wrap: wrap; }
        .case-title { font-family: var(--font-serif); font-size: 1.5rem; margin: 0; line-height: 1.2; color: var(--text-main); }
        .case-strapline { font-size: 0.9rem; color: #555; font-family: var(--font-mono); }
        .case-meta { font-family: var(--font-mono); font-size: 0.75rem; text-transform: uppercase; color: #777; text-align: right; }

        /* BADGES & TAGS */
        .case-badges-row { display: flex; flex-wrap: wrap; gap: 0.4rem; margin-top: 1rem; }
        .case-tag { display: inline-flex; align-items: center; padding: 0.25rem 0.65rem; border-radius: 4px; background-color: #EFEFEF; font-family: var(--font-mono); font-size: 0.75rem; color: #444; transition: all 0.2s ease; position: relative; }
        .case-tag strong { color: #000; margin-right: 4px; font-weight: 500; }
        .clickable-badge { cursor: pointer; border-bottom: 1px solid transparent; }
        .clickable-badge:hover { filter: brightness(0.95); transform: translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .jurisdiction-tag { background-color: #e3f2fd; color: #0d47a1; border: 1px solid #bbdefb; }
        .law-tag { background-color: #fff3e0; color: #e65100; border: 1px solid #ffe0b2; }

        /* TOOLTIPS */
        .case-tooltip-popup { visibility: hidden; width: 280px; background-color: #222; color: #fff; text-align: center; border-radius: 4px; padding: 0.8rem; position: absolute; z-index: 1000; bottom: 135%; left: 50%; transform: translateX(-50%); opacity: 0; transition: opacity 0.3s; font-family: var(--font-sans); font-size: 0.85rem; line-height: 1.4; pointer-events: none; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .case-tooltip-popup::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -6px; border-width: 6px; border-style: solid; border-color: #222 transparent transparent transparent; }
        .case-tag:hover .case-tooltip-popup { visibility: visible; opacity: 1; transform: translateX(-50%) translateY(-5px); }

        /* KNOWLEDGE CARD */
        .knowledge-card { background-color: #fff; border: 1px solid var(--text-main); border-left: 5px solid var(--text-main); padding: 1.5rem; margin-bottom: 2rem; display: none; animation: fadeIn 0.4s ease-in-out; }
        .knowledge-card h4 { margin-top: 0; margin-bottom: 0.5rem; color: var(--text-main); font-family: var(--font-serif); font-size: 1.4rem; }

        /* FILTERS */
        .filters-toolbar { display: flex; gap: 1rem; margin-bottom: 2rem; padding: 1.5rem; background: #FAFAFA; border: 1px solid var(--line-color); align-items: center; flex-wrap: wrap; }
        .filter-group { display: flex; flex-direction: column; gap: 0.5rem; flex-grow: 1; min-width: 200px; }
        .filter-select, .search-input, .autocomplete-input { padding: 0.6rem; border: 1px solid #ccc; font-family: var(--font-mono); font-size: 0.9rem; background-color: #fff; width: 100%; border-radius: 0; appearance: none; }
        .clear-filters-btn { background-color: #fff; border: 1px solid #999; color: #333; font-family: var(--font-mono); font-size: 0.8rem; padding: 0.5rem 1rem; cursor: pointer; margin-left: auto; text-transform: uppercase; transition: all 0.2s; }
        .clear-filters-btn:hover { background-color: #333; color: #fff; }
        .help-tip { cursor: help; text-decoration: underline dotted #aaa; }

        /* MOBILE */
        .mobile-menu-toggle { display: none; }
        @media (max-width: 900px) {
            .site-wrapper { flex-direction: column; }
            .sidebar { position: fixed; width: 100%; transform: translateX(-100%); z-index: 300; border-right: none; }
            .sidebar.mobile-open { transform: translateX(0); }
            .main-content { margin-left: 0; width: 100%; }
            .mobile-menu-toggle { display: flex; justify-content: space-between; padding: 1rem; background: var(--bg-color); border-bottom: 1px solid var(--line-color); position: sticky; top: 0; z-index: 200; }
            .filters-toolbar { flex-direction: column; align-items: stretch; }
        }
        
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="site-wrapper">
    <div class="mobile-menu-toggle">
        <h1 style="font-size:1.2rem; margin:0;">Alex MacMillan</h1>
        <button onclick="document.getElementById('main-sidebar').classList.toggle('mobile-open')" style="background:none; border:1px solid #000; padding:0.4rem; font-family:var(--font-mono);">MENU</button>
    </div>

    <aside class="sidebar" id="main-sidebar">
        <button onclick="document.getElementById('main-sidebar').classList.remove('mobile-open')" style="align-self:flex-end; background:none; border:none; font-size:1.5rem; cursor:pointer; display:none;" class="close-btn">×</button>
        <div>
            <header>
                <img src="professional_headshot.jpg" alt="AM" onclick="window.location.hash='#profile-view'" style="width:80px; height:80px; object-fit:cover; margin-bottom:1.5rem; filter:grayscale(100%); cursor:pointer; transition:0.3s;" onmouseover="this.style.filter='grayscale(0%)'" onmouseout="this.style.filter='grayscale(100%)'">
                <h1 style="margin-bottom:0.5rem;">Alex MacMillan</h1>
                <span class="subtitle">Employment Law Barrister</span>
                <div style="font-size:0.8rem;">St Philips Barristers</div>
            </header>
            <nav style="margin-top: 3rem;">
                <div class="nav-section">
                    <span class="nav-label">Menu</span>
                    <nav class="sidebar-nav">
                        <a onclick="window.location.hash='#profile-view'" class="nav-active">Profile & Cases</a>
                        <a onclick="window.location.hash='#articles-hub-view'">News & Insights</a>
                        <a href="https://www.st-philips.com/our_people/alexander-macmillan/" target="_blank">Chambers Profile ↗</a>
                    </nav>
                </div>
            </nav>
        </div>
        <footer class="sidebar-footer" style="font-size:0.7rem; color:#999;">&copy; 2025 Alex MacMillan</footer>
    </aside>

    <main class="main-content">
        <div id="profile-view" class="page-view fade-in">
            <section style="padding: 4rem;">
                <h2>Notable Cases</h2>
                <p>A selection of recent instructions covering the Employment Tribunal, EAT, High Court, and Court of Appeal.</p>

                <div id="knowledge-card-container" class="knowledge-card"></div>

                <div class="filters-toolbar">
                    <div class="filter-group">
                        <span class="nav-label">Keyword Search</span>
                        <input type="text" id="case-search-input" class="search-input" placeholder="e.g. 'Whistleblowing', 'Manchester'">
                    </div>
                    
                    <div class="filter-group">
                        <span class="nav-label">Practice Area</span>
                        <select id="case-type-filter" class="filter-select">
                            <option value="all">All Practice Areas</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <span class="nav-label">Instructing Firm</span>
                        <input type="text" id="case-solicitor-input" list="solicitor-datalist" class="autocomplete-input" placeholder="Type Firm Name...">
                        <datalist id="solicitor-datalist"></datalist>
                    </div>

                    <div class="filter-group">
                        <span class="nav-label">Judge</span>
                        <input type="text" id="case-judge-input" list="judges-datalist" class="autocomplete-input" placeholder="Type Judge's Name...">
                        <datalist id="judges-datalist"></datalist>
                    </div>

                    <div class="filter-group" style="flex-direction: row; align-items: center; gap: 0.5rem; min-width: 150px;">
                        <input type="checkbox" id="case-starred-filter" style="width: auto; margin: 0; cursor: pointer;">
                        <label for="case-starred-filter" style="font-size: 0.8rem; cursor: pointer; color: var(--text-main);">
                            <span class="help-tip" title="Shows starred cases from the last 3 years">Recent & Notable</span>
                        </label>
                    </div>

                    <button id="clear-filters-btn" class="clear-filters-btn">Reset ↺</button>
                    <div id="filter-count-display" style="font-family:var(--font-mono); font-size:0.8rem; color:#555; margin-left:1rem;"></div>
                </div>

                <div id="cases-list-container"></div>
                
                <div style="margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--line-color);">
                    <button onclick="alert('Word Report Generator would run here.')" class="calc-button">Download Word Report (.docx)</button>
                </div>
            </section>
        </div>
        
        <div id="articles-hub-view" class="page-view fade-in" style="display:none; padding:4rem;">
            <h2>News & Insights</h2>
            <div id="articles-grid-container" class="article-grid"></div>
        </div>
    </main>
</div>

<script src="content.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Safety Check: Ensure data loaded
        if (typeof CASES_DATA === 'undefined') {
            document.getElementById('cases-list-container').innerHTML = '<div style="color:red; padding:1rem;">Error: Data file (content.js) not loaded or corrupt.</div>';
            return;
        }
        initCases();
        handleRoute();
    });

    window.addEventListener('hashchange', handleRoute);

    function handleRoute() {
        const hash = window.location.hash || '#profile-view';
        document.querySelectorAll('.page-view').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.sidebar-nav a').forEach(el => el.classList.remove('nav-active'));

        if (hash === '#articles-hub-view') {
            document.getElementById('articles-hub-view').style.display = 'block';
            renderArticles();
        } else {
            document.getElementById('profile-view').style.display = 'block';
        }
    }

    function initCases() {
        const typeFilter = document.getElementById('case-type-filter');
        const judgeInput = document.getElementById('case-judge-input');
        const solInput = document.getElementById('case-solicitor-input');
        const searchInput = document.getElementById('case-search-input');
        const starredFilter = document.getElementById('case-starred-filter');
        const clearBtn = document.getElementById('clear-filters-btn');

        // Populate Datalists
        const jurisSet = new Set();
        const judgeSet = new Set();
        const solSet = new Set();

        CASES_DATA.forEach(c => {
            if(c.jurisdiction) c.jurisdiction.forEach(j => jurisSet.add(j));
            if(c.judge && c.judge.length > 3) judgeSet.add(c.judge);
            if(c.solicitor) solSet.add(c.solicitor);
        });

        Array.from(jurisSet).sort().forEach(j => {
            const opt = document.createElement('option'); opt.value = j; opt.innerText = j; typeFilter.appendChild(opt);
        });
        
        const judgeList = document.getElementById('judges-datalist');
        Array.from(judgeSet).sort().forEach(j => { const opt = document.createElement('option'); opt.value = j; judgeList.appendChild(opt); });

        const solList = document.getElementById('solicitor-datalist');
        Array.from(solSet).sort().forEach(s => { const opt = document.createElement('option'); opt.value = s; solList.appendChild(opt); });

        // Listeners
        typeFilter.addEventListener('change', renderCases);
        judgeInput.addEventListener('input', renderCases);
        solInput.addEventListener('input', renderCases);
        searchInput.addEventListener('keyup', renderCases);
        starredFilter.addEventListener('change', renderCases);
        clearBtn.addEventListener('click', clearFilters);

        renderCases();
    }

    function clearFilters() {
        document.getElementById('case-type-filter').value = 'all';
        document.getElementById('case-judge-input').value = '';
        document.getElementById('case-solicitor-input').value = '';
        document.getElementById('case-search-input').value = '';
        document.getElementById('case-starred-filter').checked = false;
        document.getElementById('knowledge-card-container').style.display = 'none';
        renderCases();
    }

    // Global helper for clickable badges
    window.filterByBadge = function(type, value) {
        clearFilters(); // Reset others first to show clean results
        
        if (type === 'jurisdiction') {
            document.getElementById('case-type-filter').value = value;
            // Safe Access to Knowledge Base
            if (typeof KNOWLEDGE_BASE !== 'undefined' && KNOWLEDGE_BASE[value]) {
                const card = document.getElementById('knowledge-card-container');
                card.innerHTML = `<h4>${KNOWLEDGE_BASE[value].title}</h4><p>${KNOWLEDGE_BASE[value].content}</p>`;
                card.style.display = 'block';
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        } else if (type === 'judge') {
            document.getElementById('case-judge-input').value = value;
        } else if (type === 'solicitor') {
            document.getElementById('case-solicitor-input').value = value;
        } else if (type === 'caselaw') {
            document.getElementById('case-search-input').value = value;
        }
        renderCases();
    }

    function renderCases() {
        const container = document.getElementById('cases-list-container');
        container.innerHTML = '';
        container.className = 'case-timeline';

        const typeVal = document.getElementById('case-type-filter').value;
        const judgeVal = document.getElementById('case-judge-input').value.toLowerCase();
        const solVal = document.getElementById('case-solicitor-input').value.toLowerCase();
        const searchVal = document.getElementById('case-search-input').value.toLowerCase();
        const starredVal = document.getElementById('case-starred-filter').checked;
        const currentYear = new Date().getFullYear();

        const filtered = CASES_DATA.filter(c => {
            const matchesType = (typeVal === 'all') || (c.jurisdiction && c.jurisdiction.includes(typeVal));
            const matchesJudge = !judgeVal || (c.judge && c.judge.toLowerCase().includes(judgeVal));
            const matchesSol = !solVal || (c.solicitor && c.solicitor.toLowerCase().includes(solVal));
            
            // Clean search text
            const text = `${c.title} ${c.description} ${c.court} ${c.citation}`.toLowerCase();
            const matchesSearch = !searchVal || text.includes(searchVal);
            
            let matchesStarred = true;
            if (starredVal) {
                const cYear = c.year ? parseInt(c.year) : currentYear;
                const isRecent = (currentYear - cYear) <= 3;
                matchesStarred = (c.starred === true) && isRecent;
            }

            return matchesType && matchesJudge && matchesSol && matchesSearch && matchesStarred;
        });

        document.getElementById('filter-count-display').innerText = `${filtered.length} Case${filtered.length !== 1 ? 's' : ''}`;

        if (filtered.length === 0) {
            container.innerHTML = '<p style="color:#777; font-style:italic; padding:1rem;">No cases found matching filters.</p>';
            return;
        }

        filtered.forEach(c => {
            const div = document.createElement('div');
            // Featured logic: Starred OR High Court/Appeal
            const isFeatured = /Court of Appeal|High Court|EAT/i.test(c.court || '') || c.starred;
            div.className = isFeatured ? 'case-item case-item--featured' : 'case-item';

            // Badges
            let jurisBadges = (c.jurisdiction || []).map(j => 
                `<span class="case-tag jurisdiction-tag clickable-badge" onclick="filterByBadge('jurisdiction', '${j.replace(/'/g, "\\'")}')">${j}</span>`
            ).join(' ');

            let solBadge = c.solicitor ? 
                `<span class="case-tag clickable-badge" onclick="filterByBadge('solicitor', '${c.solicitor.replace(/'/g, "\\'")}')"><strong>Firm:</strong> ${c.solicitor}</span>` : '';

            // Tooltips
            let caseLawHtml = '';
            if(c.key_case_law && c.key_case_law.length > 0) {
                const badges = c.key_case_law.map(law => {
                    const temp = document.createElement("div"); temp.innerHTML = law;
                    const plainText = (temp.textContent || temp.innerText || "").trim();
                    
                    // Dictionary Lookup (Safe)
                    let summary = null;
                    if (typeof CASE_LAW_DICTIONARY !== 'undefined') {
                        summary = CASE_LAW_DICTIONARY[plainText];
                        if (!summary) {
                            // Partial match check
                            const key = Object.keys(CASE_LAW_DICTIONARY).find(k => plainText.includes(k));
                            if(key) summary = CASE_LAW_DICTIONARY[key];
                        }
                    }
                    
                    const tooltip = summary ? `<span class="case-tooltip-popup">${summary}</span>` : '';
                    const style = summary ? 'border-bottom:1px dotted #2196f3;' : '';

                    return `<span class="case-tag clickable-badge law-tag" style="font-style:italic; ${style}" onclick="filterByBadge('caselaw', '${plainText.replace(/'/g, "\\'")}')">${law}${tooltip}</span>`;
                }).join('');
                
                caseLawHtml = `
                    <div class="case-law-section">
                        <span class="case-law-label">Key Authorities (Hover for summary)</span>
                        <div class="case-badges-row" style="margin-top:0;">${badges}</div>
                    </div>
                `;
            }

            div.innerHTML = `
                <div class="case-node"></div>
                <div class="case-year-label">${c.year}</div>
                <div class="case-header">
                    <div>
                        <h3 class="case-title">${c.title}</h3>
                        <div class="case-strapline">${c.citation || ''}</div>
                    </div>
                    <div class="case-meta-block">
                        <div class="case-meta">${c.court || ''}</div>
                        <div class="case-meta">${c.judge || ''}</div>
                    </div>
                </div>
                <p>${c.description}</p>
                ${caseLawHtml}
                <div class="case-badges-row" style="margin-top:1.25rem;">
                    ${solBadge}
                    ${jurisBadges}
                </div>
            `;
            container.appendChild(div);
        });
    }

    function renderArticles() {
        const container = document.getElementById('articles-grid-container');
        container.innerHTML = '';
        // Safe check
        if (typeof ARTICLES_DATA !== 'undefined') {
            ARTICLES_DATA.forEach(a => {
                container.innerHTML += `
                    <div class="article-card">
                        <h3>${a.title}</h3>
                        <div class="article-date">${a.date}</div>
                        <p style="font-size:0.9rem; color:#555;">${a.summary}</p>
                    </div>`;
            });
        }
    }
</script>

</body>
</html>
