<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alex MacMillan | Employment Law Barrister</title>
    <meta name="description" content="The professional website for Alex MacMillan, a UK-based employment law barrister. Specialist in discrimination, whistleblowing, and TUPE, and barrister at St Philips Chambers - Chambers of the Year - 2025 British Legal Awards.">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Alex MacMillan | Employment Law Barrister">
    <meta property="og:description" content="Specialist employment advocacy. Limitation, Redundancy, and Notice Pay calculators available online.">
    <meta property="og:image" content="https://placehold.co/1200x630/EEE/333?text=Alex+MacMillan+Barrister">
    <meta property="og:url" content="https://alexmacmillan.co.uk/">

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚öñÔ∏è</text></svg>">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@300;400;500;600&family=Space+Grotesk:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- Word Document Generation Libraries -->
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Attorney",
      "name": "Alex MacMillan",
      "url": "https://alexmacmillan.co.uk/",
      "jobTitle": "Barrister",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Birmingham",
        "addressCountry": "UK"
      },
      "affiliation": {
        "@type": "Organization",
        "name": "St Philips Barristers"
      }
    }
    </script>

    <style>
        /* --- RESET & VARIABLES --- */
        :root {
            --bg-color: #F2F2F0; /* Warm Paper White */
            --panel-bg: #FFFFFF;
            --text-main: #111111; /* Sharp Black */
            --text-muted: #555555;
            --line-color: #D1D1D1;
            --accent-color: #111111; 
            --highlight-bg: #EAEAEA;
            --highlight-yellow: #fff3cd; /* Search highlight color */
            
            --font-serif: 'DM Serif Display', serif;
            --font-sans: 'Inter', sans-serif;
            --font-mono: 'Space Grotesk', monospace; /* For numbers/calc */
            
            --sidebar-width: 320px;
            --border-width: 1px;
        }
        
        * { box-sizing: border-box; }
        
        body {
            font-family: var(--font-sans);
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* Highlight search term */
        .search-highlight {
            background-color: var(--highlight-yellow);
            padding: 0 2px;
            border-radius: 2px;
        }

        /* Tooltip Visual Cue */
        .help-tip {
            cursor: help;
            text-decoration: underline dotted #aaa;
            text-underline-offset: 3px;
        }

        /* --- LAYOUT STRUCTURE --- */
        .site-wrapper {
            display: flex;
            min-height: 100vh;
        }
        
        /* SIDEBAR (Sticky) */
        .sidebar { 
            width: var(--sidebar-width); 
            background-color: var(--bg-color); 
            border-right: var(--border-width) solid var(--line-color); 
            display: flex; 
            flex-direction: column; 
            position: fixed; 
            height: 100vh; 
            top: 0;
            left: 0;
            overflow-y: auto;
            z-index: 100; 
            padding: 2.5rem;
            justify-content: space-between;
            transition: transform 0.3s ease; /* For mobile slide-in */
        }
        
        .main-content { 
            margin-left: var(--sidebar-width); 
            width: calc(100% - var(--sidebar-width)); 
            background-color: var(--panel-bg);
            min-height: 100vh;
        }

        /* Fade Animation for content switching */
        .fade-in {
            animation: fadeIn 0.4s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- TYPOGRAPHY --- */
        h1, h2, h3, h4 { 
            font-family: var(--font-serif); 
            font-weight: 400; 
            color: var(--text-main);
            margin-top: 0;
        }

        h1 { font-size: 2.5rem; line-height: 1.1; margin-bottom: 0.5rem; }
        .subtitle { font-family: var(--font-mono); font-size: 0.85rem; letter-spacing: 0.05em; text-transform: uppercase; color: var(--text-muted); margin-bottom: 2rem; display: block; }
        
        h2 { 
            font-size: 3rem; 
            border-bottom: var(--border-width) solid var(--line-color); 
            padding-bottom: 1.5rem; 
            margin-bottom: 2rem; 
            margin-top: 0;
        }

        p { font-size: 1.05rem; color: #333; max-width: 700px; margin-bottom: 1.5rem; }
        
        /* --- NAVIGATION --- */
        .nav-section { margin-bottom: 3rem; }
        .nav-label { 
            font-family: var(--font-mono); 
            font-size: 0.7rem; 
            text-transform: uppercase; 
            letter-spacing: 0.1em; 
            color: #888; 
            margin-bottom: 1rem; 
            display: block; 
            cursor: pointer; /* Pointer for collapsibles */
        }
        
        /* Collapsible Arrow */
        .nav-label::after {
            content: '‚ñº';
            font-size: 0.6em;
            margin-left: 5px;
            display: none; /* Only show on mobile */
        }

        .sidebar-nav {
            /* Default visible */
            display: block; 
        }

        .sidebar-nav a { 
            display: block; 
            font-family: var(--font-sans);
            font-size: 1rem;
            text-decoration: none; 
            color: var(--text-muted); 
            padding: 0.5rem 0; 
            border-bottom: 1px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .sidebar-nav a:hover { color: var(--text-main); padding-left: 5px; }
        .sidebar-nav a.nav-active { 
            color: var(--text-main); 
            font-weight: 500; 
            border-bottom: 1px solid var(--text-main);
            display: inline-block;
        }

        /* --- PROFILE --- */
        .profile-photo { 
            width: 80px; 
            height: 80px; 
            object-fit: cover; 
            margin-bottom: 1.5rem;
            filter: grayscale(100%); /* Elegant B&W */
            transition: filter 0.3s ease;
            cursor: pointer;
        }
        .profile-photo:hover { filter: grayscale(0%); }

        .contact-email {
            font-family: var(--font-mono);
            font-size: 0.85rem;
            margin-top: 1rem;
            display: block;
            color: var(--text-main);
        }

        /* --- SECTIONS & GRIDS --- */
        section { padding: 4rem 4rem 6rem 4rem; border-bottom: 1px solid var(--line-color); }
        
        /* --- TIMELINE CASES --- */
        .case-timeline {
            position: relative;
            margin-top: 2rem;
            padding-left: 1.5rem;
        }

        /* Vertical spine */
        .case-timeline::before {
            content: "";
            position: absolute;
            left: 14px;
            top: 0;
            bottom: 0;
            width: 1px;
            background: var(--line-color);
        }

        /* Individual case block */
        .case-item {
            position: relative;
            margin-left: 1.5rem;
            padding: 1.75rem 0 1.75rem 1.75rem;
            border-bottom: 1px solid var(--line-color);
        }

        /* Featured highlight (Appellate/High Court) */
        .case-item--featured {
            background-color: #FAFAFA; /* Subtle highlight */
            border-radius: 8px;
            border: 1px solid #E0E0E0;
            padding: 2rem 1.75rem 2rem 1.75rem;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        /* Timeline dot */
        .case-node {
            position: absolute;
            left: -2.25rem;
            top: 2.2rem;
            width: 12px;
            height: 12px;
            border-radius: 999px;
            background-color: #FFFFFF;
            border: 2px solid var(--text-main);
            z-index: 10;
        }

        .case-item--featured .case-node {
            background-color: var(--text-main); /* Filled dot for featured */
        }

        .case-year-label {
            position: absolute;
            left: -4.5rem;
            top: 1.85rem;
            font-family: var(--font-mono);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
        }

        /* Header area: title + strapline + meta */
        .case-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1.5rem;
            flex-wrap: wrap;
            margin-bottom: 0.5rem;
        }

        .case-header-main {
            max-width: 70%;
            min-width: 240px;
        }

        .case-title {
            font-family: var(--font-serif);
            font-size: 1.5rem;
            margin: 0 0 0.25rem 0;
            color: var(--text-main);
            line-height: 1.2;
        }

        /* One-line summary under title */
        .case-strapline {
            font-size: 0.9rem;
            color: #555555;
            font-family: var(--font-sans);
        }

        /* Right-hand meta (Court/Citation/Pill) */
        .case-meta-block {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.35rem;
            min-width: 160px;
        }

        .case-meta-block .case-meta {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #777777;
            text-align: right;
        }

        /* Practice area pill */
        .case-type-pill {
            display: inline-block;
            padding: 0.15rem 0.65rem;
            border-radius: 999px;
            border: 1px solid var(--line-color);
            font-family: var(--font-mono);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #555555;
            background-color: #FAFAFA;
        }

        /* Case body text */
        .case-item > p {
            font-size: 0.95rem;
            color: #333333;
            margin: 0.75rem 0 0.75rem 0;
            max-width: 650px; /* Constrained width for readability */
            line-height: 1.6;
        }

        /* Case Law Section */
        .case-law-section {
            margin-top: 1rem;
            padding-top: 0.75rem;
            border-top: 1px dashed #e0e0e0;
        }
        
        .case-law-label {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: block;
            margin-bottom: 0.5rem;
        }

        /* Tags row under each case */
        .case-badges-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            margin-top: 1rem;
        }

        .case-tag {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.65rem;
            border-radius: 4px;
            background-color: #EFEFEF;
            font-family: var(--font-mono);
            font-size: 0.75rem;
            color: #444;
            transition: all 0.2s ease;
        }
        
        .case-tag.law-tag {
            background-color: #e3f2fd;
            color: #0d47a1;
            border: 1px solid #bbdefb;
        }
        
        .case-tag strong { color: #000; margin-right: 4px; font-weight: 500; }
        
        /* New Clickable Tag Style */
        .clickable-tag {
            cursor: pointer;
            border-bottom: 1px solid transparent;
        }
        
        .clickable-tag:hover {
            background-color: #dcdcdc; /* Darker grey on hover */
            border-bottom: 1px solid #999;
        }
        
        .clickable-tag:active {
            background-color: #ccc;
        }

        /* Ensure no double borders at end of list */
        .case-item:last-child {
            border-bottom: none;
        }

        /* --- CASE FILTERS --- */
        .filters-toolbar {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #FAFAFA;
            border: 1px solid var(--line-color);
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            flex-grow: 1;
        }

        .filter-select, .search-input {
            padding: 0.6rem;
            border: 1px solid #ccc;
            font-family: var(--font-mono);
            font-size: 0.9rem;
            background-color: #fff;
            width: 100%;
        }
        
        .search-input {
            border-radius: 0;
            appearance: none;
        }

        .filter-count {
            font-family: var(--font-mono);
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-left: auto;
            align-self: center;
        }

        /* --- LOCATION BADGES --- */
        .location-summary {
            margin-bottom: 2rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--line-color);
        }
        .location-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .loc-pill {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            color: #666;
            border: 1px solid #ddd;
            padding: 0.2rem 0.6rem;
            border-radius: 99px;
        }
        
        /* --- TESTIMONIALS CAROUSEL --- */
        .testimonials-container {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--line-color);
            position: relative;
            overflow: hidden;
        }
        .testimonials-wrapper {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        .testimonial-slide {
            min-width: 100%;
            padding: 1rem;
            box-sizing: border-box;
        }
        .testimonial-text {
            font-family: var(--font-serif);
            font-size: 1.3rem;
            line-height: 1.5;
            color: var(--text-main);
            font-style: italic;
            margin-bottom: 1rem;
        }
        .testimonial-author {
            font-family: var(--font-sans);
            font-size: 0.9rem;
            color: var(--text-muted);
            font-weight: 500;
        }
        .testimonial-controls {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1rem;
        }
        .control-btn {
            background: none;
            border: 1px solid var(--line-color);
            color: var(--text-muted);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            transition: all 0.2s;
        }
        .control-btn:hover {
            border-color: var(--text-main);
            color: var(--text-main);
        }

        /* --- ARTICLE GRID (Minimalist) --- */
        .article-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            border-top: 1px solid var(--line-color);
            border-left: 1px solid var(--line-color);
        }

        .article-card {
            border-right: 1px solid var(--line-color);
            border-bottom: 1px solid var(--line-color);
            padding: 2rem;
            background: transparent;
            transition: background-color 0.2s;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 280px;
        }

        .article-card:hover { background-color: #FAFAFA; }
        .article-card h3 { font-size: 1.6rem; margin-bottom: 1rem; line-height: 1.2; }
        .article-date { font-family: var(--font-mono); font-size: 0.8rem; color: #888; margin-bottom: 1rem; }
        .read-more-link { font-family: var(--font-mono); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; margin-top: auto; }

        /* --- LATEST INSIGHT ON HOME --- */
        .latest-insight-box {
            background-color: #f9f9f9;
            border-left: 3px solid var(--text-main);
            padding: 1.5rem;
            margin-bottom: 2rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .latest-insight-box:hover { background-color: #f0f0f0; }
        .latest-insight-label { font-family: var(--font-mono); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); margin-bottom: 0.5rem; display:block; }
        .latest-insight-title { font-family: var(--font-serif); font-size: 1.4rem; margin: 0 0 0.5rem 0; color: var(--text-main); }

        /* --- CALCULATORS (The Technical Look) --- */
        .calculator-inputs { margin-bottom: 3rem; max-width: 800px; }
        .calculator-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 2rem; margin-bottom: 1.5rem; }
        
        /* Elegant Inputs */
        input[type="text"], input[type="number"], input[type="date"], select { 
            width: 100%; 
            padding: 0.8rem 0; 
            border: none; 
            border-bottom: 1px solid var(--text-main); 
            background: transparent; 
            font-family: var(--font-mono); 
            font-size: 1.1rem; 
            color: var(--text-main);
            border-radius: 0;
        }
        input:focus, select:focus { outline: none; border-bottom: 2px solid var(--text-main); background-color: #FAFAFA; }
        label { display: block; font-family: var(--font-sans); font-size: 0.8rem; color: #666; margin-bottom: 0.2rem; }

        /* Buttons (Architectural) */
        .calc-button, #add-respondent-btn, .print-btn { 
            font-family: var(--font-mono); 
            font-size: 0.9rem; 
            text-transform: uppercase; 
            letter-spacing: 0.1em;
            background: transparent;
            color: var(--text-main);
            border: 1px solid var(--text-main);
            padding: 1rem 2rem;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 1rem;
            width: auto;
            display: inline-block;
        }
        
        .calc-button:hover, #add-respondent-btn:hover { background: var(--text-main); color: #fff; }
        
        /* Results Table */
        .results-table { width: 100%; border-collapse: collapse; font-family: var(--font-mono); margin-top: 2rem; }
        .results-table th { text-align: left; font-weight: normal; color: #888; border-bottom: 1px solid var(--line-color); padding: 1rem 0.5rem; }
        .results-table td { border-bottom: 1px solid #eee; padding: 1rem 0.5rem; }
        .highlight-row { background-color: #F0F8F0; }

        .result-summary { 
            font-family: var(--font-serif); 
            font-size: 1.8rem; 
            padding: 1.5rem; 
            border: 1px solid var(--text-main); 
            margin-bottom: 2rem; 
        }

        .pay-result-box { 
            background: #F9F9F9; 
            padding: 2rem; 
            border-left: 4px solid var(--text-main); 
        }
        .result-headline { font-family: var(--font-mono); font-size: 3rem; margin: 1rem 0; }

        /* --- DISCIPLINARY CHECKLIST --- */
        .checklist-question { padding: 1.5rem 0; border-bottom: 1px solid #eee; }
        .checklist-question p { font-weight: 500; font-size: 1.1rem; margin-bottom: 1rem; }
        .checklist-question label { display: inline-block; margin-right: 2rem; font-size: 1rem; color: var(--text-main); cursor: pointer; }
        
        .report-red { border: 1px solid #ffcccc; background: #fff5f5; padding: 1.5rem; margin-bottom: 1rem; }
        .report-green { border: 1px solid #ccffcc; background: #f0fff0; padding: 1.5rem; margin-bottom: 1rem; }

        /* --- FOOTER --- */
        .sidebar-footer { font-size: 0.7rem; color: #999; margin-top: auto; }

        /* Mobile Menu Toggle (Hidden on Desktop) */
        .mobile-menu-toggle { display: none; }
        .sidebar-close-btn { display: none; }

        /* --- MOBILE OPTIMIZATION --- */
        @media (max-width: 900px) {
            .site-wrapper { flex-direction: column; }
            
            /* Mobile Header Bar */
            .mobile-menu-toggle { 
                display: flex; 
                justify-content: space-between; 
                align-items: center; 
                padding: 1rem; 
                background: var(--bg-color); 
                border-bottom: 1px solid var(--line-color); 
                position: sticky; 
                top: 0; 
                z-index: 200;
            }
            .mobile-title { font-family: var(--font-serif); font-size: 1.2rem; font-weight: 600; margin: 0; }
            .menu-btn { background: none; border: 1px solid var(--text-main); padding: 0.4rem 0.8rem; font-family: var(--font-mono); font-size: 0.8rem; text-transform: uppercase; }

            .sidebar { 
                position: fixed; 
                width: 100%; 
                height: 100vh; 
                padding: 2rem; 
                border-right: none; 
                transform: translateX(-100%); /* Hide by default on mobile */
                z-index: 300;
                top: 0; 
                /* Re-assert flex display */
                display: flex; 
            }
            .sidebar.mobile-open { transform: translateX(0); } /* Slide in */
            
            /* Collapsible Mobile Navigation */
            .nav-section .sidebar-nav {
                display: none; /* Hidden by default on mobile */
            }
            .nav-label::after {
                display: inline-block; /* Show arrow */
            }
            .nav-label.expanded + .sidebar-nav {
                display: block; /* Show when expanded */
            }
            /* Keep Menu open by default though */
            .nav-section:first-child .sidebar-nav {
                display: block;
            }
            
            .main-content { margin-left: 0; width: 100%; min-height: auto; margin-top: 0; }
            section { padding: 2rem; }
            h2 { font-size: 2rem; }
            .article-grid { grid-template-columns: 1fr; }
            
            /* Timeline Mobile Fixes */
            .case-timeline { padding-left: 0.5rem; }
            .case-timeline::before { left: 10px; }
            .case-item, .case-item--featured { margin-left: 1.5rem; padding-left: 1.25rem; }
            .case-node { left: -2rem; }
            .case-year-label { left: -4.1rem; }
            .case-header-main { max-width: 100%; }
            .case-meta-block { align-items: flex-start; }
            .case-meta-block .case-meta { text-align: left; }
            
            /* Close button for sidebar on mobile */
            .sidebar-close-btn { 
                display: block; position: absolute; top: 1rem; right: 1rem; 
                background: none; border: none; font-size: 1.5rem; cursor: pointer;
                color: var(--text-main);
            }
            
            .filters-toolbar { flex-direction: column; align-items: stretch; }
        }

        /* --- PRINT STYLES --- */
        @media print {
            .sidebar, .cookie-banner, .back-btn, .calc-button, #add-respondent-btn, .calculator-inputs, .print-btn, .filters-toolbar, .mobile-menu-toggle { 
                display: none !important; 
            }
            .site-wrapper { display: block; }
            .main-content { margin: 0; width: 100%; padding: 0; border: none; }
            section { padding: 0; border: none; }
            .result-summary-visible, .pay-result-visible, .report-visible, .cp-report-visible { display: block !important; }
            
            /* Ensure the content expands */
            body { font-size: 10pt; background: #fff; }
            h2 { font-size: 20pt; border-bottom: 2px solid #000; }
            
            /* CP Report Table adjustments for print */
            .results-table th, .results-table td { padding: 5px; font-size: 9pt; border: 1px solid #000; }
            
            /* Timeline print fix */
            .case-timeline::before, .case-node, .case-year-label { display: none; }
            .case-item { margin-left: 0; border-bottom: 1px solid #000; padding: 1rem 0; page-break-inside: avoid; }
        }
        
        /* --- UTILS --- */
        .error-message { color: #D00; font-family: var(--font-mono); margin: 1rem 0; }
        .back-btn { display: inline-block; margin-bottom: 2rem; text-decoration: none; color: var(--text-muted); font-family: var(--font-mono); }
        .testimonial-box { font-style: italic; font-family: var(--font-serif); font-size: 1.2rem; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--line-color); }
        .video-responsive { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; margin: 2rem 0; background: #000; }
        .video-responsive iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        .disclaimer-box {
            font-size: 0.8rem;
            color: #666;
            background-color: #f9f9f9;
            border: 1px solid #e0e0e0;
            padding: 1rem;
            margin-bottom: 2rem;
            line-height: 1.4;
        }

        /* Cookie Banner */
        .cookie-banner { position: fixed; bottom: 0; left: 0; width: 100%; background: #111; color: #fff; padding: 1rem; display: none; justify-content: space-between; align-items: center; z-index: 999; }
        .cookie-btn { background: #fff; color: #111; border: none; padding: 0.5rem 1rem; font-family: var(--font-mono); cursor: pointer; margin-left: 1rem; }
    </style>
</head>
<body>

<div class="site-wrapper">

    <div class="mobile-menu-toggle">
        <h1 class="mobile-title">Alex MacMillan</h1>
        <button class="menu-btn" onclick="toggleMobileMenu()">Menu</button>
    </div>

    <aside class="sidebar" id="main-sidebar">
        <button class="sidebar-close-btn" onclick="toggleMobileMenu()">√ó</button>
        <div>
            <header>
                <img src="professional_headshot.jpg" 
                     alt="AM" 
                     class="profile-photo" 
                     onclick="window.location.hash = '#profile-view'"
                     onerror="this.onerror=null;this.src='https://placehold.co/100x100/EEE/333?text=AM';">
                <h1>Alex MacMillan</h1>
                <span class="subtitle">Employment Law Barrister</span>
                <div style="font-size: 0.8rem; margin-bottom: 0.5rem;">Called: 2015</div>
                <div style="font-size: 0.8rem;">St Philips Barristers</div>
            </header>

            <nav style="margin-top: 3rem;">
                <div class="nav-section">
                    <span class="nav-label expanded" onclick="toggleSection(this)">Menu</span>
                    <nav class="sidebar-nav">
                        <a data-hash="#profile-view" class="nav-active">Profile & Cases</a>
                        <a data-hash="#articles-hub-view">News & Insights</a>
                        <a href="https://www.st-philips.com/our_people/alexander-macmillan/" target="_blank">Chambers Profile ‚Üó</a>
                    </nav>
                </div>

                <div class="nav-section">
                    <span class="nav-label" onclick="toggleSection(this)">Tools</span>
                    <nav class="sidebar-nav">
                        <a data-hash="#limitation-view">Limitation Calc</a>
                        <a data-hash="#notice-pay-view">Notice Pay Calc</a>
                        <a data-hash="#holiday-pay-view">Holiday Pay</a>
                        <a data-hash="#redundancy-pay-view">Redundancy</a>
                        <a data-hash="#disciplinary-view">Disciplinary Check</a>
                        <a data-hash="#pension-loss-view">Simple & Complex Pension Loss Calc</a>
                        <a data-hash="#quantum-risk-view">Quantum Risk Calc</a>
                    </nav>
                </div>
            </nav>
        </div>

        <div>
            <div class="nav-section">
                <span class="nav-label">Instruct</span>
                <a href="mailto:employment&pi@st-philips.com" class="contact-email">employment&pi@st-philips.com</a>
                <div style="font-size: 0.85rem; margin-top: 0.5rem; color: #666;">+44 (0) 121 246 7015</div>
                <a href="mailto:employment&pi@st-philips.com?subject=Enquiry%20for%20Alex%20MacMillan" 
                   style="display: block; margin-top: 1rem; text-decoration: underline; color: var(--text-main); font-size: 0.9rem;">
                   Email Clerks Direct ‚Üí
                </a>
            </div>
            
            <div class="testimonial-box">
                "A superb and effective trial counsel."
            </div>
            <footer class="sidebar-footer" style="margin-top: 1rem;">
                &copy; 2025 Alex MacMillan
            </footer>
        </div>
    </aside>

    <main class="main-content">
        
        <div id="profile-view" class="page-view fade-in">
            <section id="about">
                <h2>Profile</h2>
                <p style="font-size: 1.4rem; font-family: var(--font-serif); line-height: 1.4;">
                    Specialist employment advocacy for complex disputes, focusing on discrimination, whistleblowing, TUPE, and cross-border issues.
                </p>
                <p>
                    Regularly instructed in high-value matters for financial institutions, retailers, and local authorities. Significant recent experience in the EAT, High Court, and Court of Appeal.
                </p>
                
                <div id="home-latest-insight-container" style="margin-top: 3rem;"></div>
                
                <!-- NEW TESTIMONIALS SECTION -->
                <div class="testimonials-container">
                    <span class="nav-label" style="display:block; margin-bottom:1rem;">Client Feedback</span>
                    <div id="testimonials-wrapper" class="testimonials-wrapper"></div>
                    <div class="testimonial-controls">
                        <button class="control-btn" id="prev-testimonial">‚Üê</button>
                        <button class="control-btn" id="next-testimonial">‚Üí</button>
                    </div>
                </div>

                <div style="margin-top: 3rem; border-top: 1px solid var(--line-color); padding-top: 2rem;">
                     <span class="nav-label">Education</span>
                     <ul class="content-list" style="max-width: none;">
                        <li><strong>BPTC</strong> ‚Äì Inns of Court School of Law (The City Law School)</li>
                        <li><strong>GDL</strong> ‚Äì University of Law</li>
                        <li><strong>PhD, MPhil</strong> ‚Äì University of Cambridge</li>
                        <li><strong>BA</strong> ‚Äì University College London</li>
                     </ul>
                </div>
            </section>

            <section id="notable-cases">
                <h2>Notable Cases</h2>
                <p>A chronological selection of instructions in the Employment Tribunal, EAT, and Court of Appeal.</p>
                
                <!-- Dynamic Location Summary -->
                <div id="location-summary-container" class="location-summary" style="display:none;">
                    <span class="nav-label" style="display:block; margin-bottom:0.5rem;">Recent Hearing Locations (Nationwide Reach)</span>
                    <div id="location-pills" class="location-pills"></div>
                </div>

                <div class="filters-toolbar">
                    <!-- Keyword Search -->
                    <div class="filter-group">
                        <span class="nav-label" style="margin:0;">Keyword Search</span>
                        <input type="text" id="case-search-input" class="search-input" placeholder="e.g. 'Whistleblowing', 'Manchester'">
                    </div>
                    
                    <!-- Practice Area -->
                    <div class="filter-group">
                        <span class="nav-label" style="margin:0;">Practice Area</span>
                        <select id="case-type-filter" class="filter-select">
                            <option value="all">All Practice Areas</option>
                        </select>
                    </div>

                    <!-- Court Level -->
                    <div class="filter-group">
                        <span class="nav-label help-tip" style="margin:0;" 
                              title="Filter cases by the seniority of the court (e.g., Employment Tribunal vs. Court of Appeal).">
                            Court Level
                        </span>
                        <select id="case-court-filter" class="filter-select">
                            <option value="all">All Courts</option>
                            <option value="et">Employment Tribunal</option>
                            <option value="eat">EAT (Appellate)</option>
                            <option value="ca">Court of Appeal / High Court</option>
                            <option value="cc">County Court</option>
                        </select>
                    </div>

                    <!-- Judge (NEW) -->
                    <div class="filter-group">
                        <span class="nav-label help-tip" style="margin:0;" 
                              title="Filter by specific Judge (dynamically populated from case list).">
                            Judge
                        </span>
                        <select id="case-judge-filter" class="filter-select">
                            <option value="all">All Judges</option>
                        </select>
                    </div>

                    <!-- Hearing Type (NEW) -->
                    <div class="filter-group">
                        <span class="nav-label help-tip" style="margin:0;" 
                              title="Filter by the type of hearing (Preliminary vs Final).">
                            Hearing Type
                        </span>
                        <select id="case-hearing-type-filter" class="filter-select">
                            <option value="all">All Types</option>
                            <option value="final">Final Hearing</option>
                            <option value="prelim">Preliminary Hearing (CM)</option>
                            <option value="open_prelim">Open Preliminary Hearing</option>
                        </select>
                    </div>

                    <!-- Instructing Firm (NEW) -->
                    <div class="filter-group">
                        <span class="nav-label help-tip" style="margin:0;" 
                              title="Filter by the instructing solicitor's firm or Direct Access instruction.">
                            Instructing Firm
                        </span>
                        <select id="case-firm-filter" class="filter-select">
                            <option value="all">All Firms</option>
                        </select>
                    </div>

                    <!-- Timeframe (UPDATED) -->
                    <div class="filter-group">
                        <span class="nav-label" style="margin:0;">Timeframe</span>
                        <select id="case-year-filter" class="filter-select">
                            <option value="5">Past 5 Years (Default)</option>
                            <option value="1">Past Year</option>
                            <option value="2">Past 2 Years</option>
                            <option value="3">Past 3 Years</option>
                            <option value="4">Past 4 Years</option>
                            <option value="all">All Time</option>
                        </select>
                    </div>
                    
                    <!-- Recent & Notable Checkbox with Updated Label -->
                    <div class="filter-group" style="flex-direction: row; align-items: center; gap: 0.5rem; min-width: 200px;">
                        <input type="checkbox" id="case-starred-filter" style="width: auto; margin: 0; cursor: pointer;">
                        
                        <label for="case-starred-filter" 
                               style="margin: 0; cursor: pointer; font-weight: 500; color: var(--text-main);"
                               title="When checked, this restricts the list to cases marked as 'Significant' or 'Starred' within the last 3 calendar years.">
                            
                            <span class="help-tip">Recent & Notable Cases</span><br>
                            <span style="font-size: 0.7rem; color: #777; font-weight: normal;">(Starred ‚Ä¢ Last 3 Years)</span>
                        </label>
                    </div>

                    <div id="filter-count-display" class="filter-count"></div>
                </div>

                <div id="cases-list-container">
                    </div>
                
                <div style="margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--line-color);">
                    <button id="generate-cases-report-btn" class="calc-button">Download Word Report (.docx)</button>
                    <div id="cp-report-container" class="cp-report-visible" style="display: none; margin-top: 2rem;"></div>
                </div>
            </section>
        </div>

        <div id="articles-hub-view" class="page-view fade-in" style="display: none;">
            <section style="padding-bottom: 0;">
                <h2>News & Insights</h2>
                <p>Commentary on case law and practice.</p>
            </section>
            <div id="articles-grid-container" class="article-grid">
                </div>
        </div>

        <div id="article-reader-view" class="page-view fade-in" style="display: none;">
            <section>
                <a href="javascript:void(0);" onclick="window.location.hash = '#articles-hub-view'" class="back-btn">‚Üê Index</a>
                <div id="article-reader-content">
                    </div>
            </section>
        </div>

        <div id="limitation-view" class="page-view fade-in" style="display: none;">
            <section>
                <h2>Limitation Calculator</h2>
                <p>Estimates statutory deadlines based on ACAS Early Conciliation extension rules.</p>
                
                <div class="disclaimer-box">
                    <strong>For Educational & Illustrative Purposes Only</strong><br><br>
                    This is not legal advice. The output is an estimation based on the variables you input. It is not a substitute for a formal opinion from a qualified barrister or solicitor on the specific facts of a case.
                    Use of this tool does not create a barrister-client relationship.
                    The figures generated are for informational purposes only and should not be relied upon for making any legal, financial, or strategic decisions.
                    The accuracy of the output is entirely dependent on the assumptions and data entered. No warranty is given as to its accuracy.
                    No liability is accepted for any loss or damage arising from the use of this tool. For professional advice, please seek a formal opinion.
                </div>

                <div class="calculator-inputs">
                    <h4 style="margin-top: 2rem;">1. Claim Details</h4>
                    <div class="calculator-grid">
                        <div>
                            <label>Limitation Period</label>
                            <select id="claim_type">
                                <option value="3">3 Months (Dismissal/Discrimination)</option>
                                <option value="6">6 Months (Redundancy/Equal Pay)</option>
                            </select>
                        </div>
                        <div>
                            <label>Effective Date of Termination (EDT)</label>
                            <input type="date" id="event_date">
                        </div>
                    </div>

                    <h4 style="margin-top: 2rem;">2. ACAS Conciliation Dates</h4>
                    <div id="respondents-container"></div>
                    <button id="add-respondent-btn">+ Add Respondent</button>
                </div>

                <div style="border-top: 1px solid var(--line-color); padding-top: 2rem;">
                    <button id="calculate-btn" class="calc-button">Calculate Deadline</button>
                    <div id="error-message" class="error-message" style="display:none;"></div>
                </div>

                <div id="limitation-calculator-results" class="result-summary-visible" style="display: none; margin-top: 3rem;">
                    <div id="result-summary-container"></div>
                    <table class="results-table">
                        <thead><tr><th>Respondent</th><th>Final Deadline</th><th>Method</th></tr></thead>
                        <tbody id="results-table-body"></tbody>
                    </table>
                    <button class="print-btn" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>
                </div>
            </section>
        </div>

        <div id="notice-pay-view" class="page-view fade-in" style="display: none;">
            <section>
                <h2>Statutory Notice Pay Calculator</h2>
                <p>Determines if statutory notice pay (full pay) applies during the notice period or if contractual notice prevails.</p>
                
                <div class="disclaimer-box">
                    <strong>For Educational & Illustrative Purposes Only</strong><br><br>
                    This is not legal advice. The output is an estimation based on the variables you input. It is not a substitute for a formal opinion from a qualified barrister or solicitor on the specific facts of a case.
                    Use of this tool does not create a barrister-client relationship.
                    The figures generated are for informational purposes only and should not be relied upon for making any legal, financial, or strategic decisions.
                    The accuracy of the output is entirely dependent on the assumptions and data entered. No warranty is given as to its accuracy.
                    No liability is accepted for any loss or damage arising from the use of this tool. For professional advice, please seek a formal opinion.
                </div>

                <div class="calculator-inputs" style="margin-top: 2rem;">
                    <div class="calculator-grid">
                        <div><label>Start Date of Employment</label><input type="date" id="np-start-date"></div>
                        <div><label>Date Notice Given / Termination</label><input type="date" id="np-end-date"></div>
                        <div><label>Contractual Notice (Weeks)</label><input type="number" id="np-contract-notice" placeholder="e.g. 4"></div>
                        <div><label>Gross Weekly Pay</label><input type="number" id="np-weekly-pay" placeholder="¬£"></div>
                    </div>
                    <button id="calculate-np-btn" class="calc-button">Calculate Entitlement</button>
                </div>
                <div id="np-results" class="pay-result-visible" style="display: none;"></div>
            </section>
        </div>

        <div id="holiday-pay-view" class="page-view fade-in" style="display: none;">
            <section>
                <h2>Holiday Pay</h2>
                <p>For irregular-hours workers (52-week reference period estimate).</p>
                
                <div class="disclaimer-box">
                    <strong>For Educational & Illustrative Purposes Only</strong><br><br>
                    This is not legal advice. The output is an estimation based on the variables you input. It is not a substitute for a formal opinion from a qualified barrister or solicitor on the specific facts of a case.
                    Use of this tool does not create a barrister-client relationship.
                    The figures generated are for informational purposes only and should not be relied upon for making any legal, financial, or strategic decisions.
                    The accuracy of the output is entirely dependent on the assumptions and data entered. No warranty is given as to its accuracy.
                    No liability is accepted for any loss or damage arising from the use of this tool. For professional advice, please seek a formal opinion.
                </div>

                <div class="calculator-inputs" style="margin-top: 2rem;">
                    <div class="calculator-grid">
                        <div>
                            <label>Total Gross Pay (52 weeks)</label>
                            <input type="number" id="hp-total-pay" placeholder="¬£">
                        </div>
                        <div>
                            <label>Weeks Worked</label>
                            <input type="number" id="hp-weeks-worked" placeholder="e.g. 46">
                        </div>
                    </div>
                    <button id="calculate-hp-btn" class="calc-button">Calculate</button>
                </div>
                <div id="hp-results" class="pay-result-visible" style="display: none;"></div>
            </section>
        </div>

        <div id="redundancy-pay-view" class="page-view fade-in" style="display: none;">
            <section>
                <h2>Redundancy Pay</h2>
                <p>Statutory minimum calculator. Cap: ¬£719/week (April 2025).</p>
                
                <div class="disclaimer-box">
                    <strong>For Educational & Illustrative Purposes Only</strong><br><br>
                    This is not legal advice. The output is an estimation based on the variables you input. It is not a substitute for a formal opinion from a qualified barrister or solicitor on the specific facts of a case.
                    Use of this tool does not create a barrister-client relationship.
                    The figures generated are for informational purposes only and should not be relied upon for making any legal, financial, or strategic decisions.
                    The accuracy of the output is entirely dependent on the assumptions and data entered. No warranty is given as to its accuracy.
                    No liability is accepted for any loss or damage arising from the use of this tool. For professional advice, please seek a formal opinion.
                </div>

                <div class="calculator-inputs" style="margin-top: 2rem;">
                    <div class="calculator-grid">
                        <div><label>Date of Birth</label><input type="date" id="rp-dob"></div>
                        <div><label>Start Date</label><input type="date" id="rp-start-date"></div>
                        <div><label>Redundancy Date</label><input type="date" id="rp-end-date"></div>
                        <div><label>Gross Weekly Pay</label><input type="number" id="rp-weekly-pay" placeholder="¬£"></div>
                    </div>
                    <button id="calculate-rp-btn" class="calc-button">Calculate</button>
                </div>
                <div id="rp-results" class="pay-result-visible" style="display: none;"></div>
            </section>
        </div>

        <div id="pension-loss-view" class="page-view fade-in" style="display: none;">
            <section style="padding: 0; height: 100vh; overflow: hidden; border-bottom: none;">
                <iframe 
                    src="https://pensionloss-sfkjpwsy5kupvse623a3ko.streamlit.app/?embed=true"
                    style="width: 100%; height: 100%; border: none;"
                    title="Pension Loss Calculator">
                </iframe>
            </section>
        </div>

        <div id="quantum-risk-view" class="page-view fade-in" style="display: none;">
            <section style="padding: 0; height: 100vh; overflow: hidden; border-bottom: none;">
                <iframe 
                    src="https://quantum-risk-tool.streamlit.app/?embed=true" 
                    style="width: 100%; height: 100%; border: none;"
                    title="Quantum Risk Estimator">
                </iframe>
            </section>
        </div>
        
        <div id="disciplinary-view" class="page-view fade-in" style="display: none;">
            <section>
                <h2>Disciplinary Audit</h2>
                <p>ACAS Code of Practice health check.</p>
                
                <div class="disclaimer-box">
                    <strong>For Educational & Illustrative Purposes Only</strong><br><br>
                    This is not legal advice. The output is an estimation based on the variables you input. It is not a substitute for a formal opinion from a qualified barrister or solicitor on the specific facts of a case.
                    Use of this tool does not create a barrister-client relationship.
                    The figures generated are for informational purposes only and should not be relied upon for making any legal, financial, or strategic decisions.
                    The accuracy of the output is entirely dependent on the assumptions and data entered. No warranty is given as to its accuracy.
                    No liability is accepted for any loss or damage arising from the use of this tool. For professional advice, please seek a formal opinion.
                </div>
                
                <form id="disciplinary-checklist-form" style="margin-top: 2rem; max-width: 800px;">
                    <h4 style="margin-top: 2rem; border-bottom: 2px solid #000; padding-bottom: 0.5rem;">The Investigation</h4>
                    <div class="checklist-question">
                        <p>1. Was an investigation conducted to establish facts before the hearing?</p>
                        <label><input type="radio" name="investigation_conducted" value="yes" required> Yes</label>
                        <label><input type="radio" name="investigation_conducted" value="no"> No</label>
                    </div>

                    <h4 style="margin-top: 2rem; border-bottom: 2px solid #000; padding-bottom: 0.5rem;">Notification</h4>
                    <div class="checklist-question">
                        <p>2. Was the employee informed of allegations in writing?</p>
                        <label><input type="radio" name="notification_written" value="yes" required> Yes</label>
                        <label><input type="radio" name="notification_written" value="no"> No</label>
                    </div>
                    <div class="checklist-question">
                        <p>3. Was evidence provided with the notification?</p>
                        <label><input type="radio" name="evidence_provided" value="yes" required> Yes</label>
                        <label><input type="radio" name="evidence_provided" value="no"> No</label>
                    </div>
                    <div class="checklist-question">
                        <p>4. Was the right to be accompanied included?</p>
                        <label><input type="radio" name="right_to_be_accompanied" value="yes" required> Yes</label>
                        <label><input type="radio" name="right_to_be_accompanied" value="no"> No</label>
                    </div>

                    <h4 style="margin-top: 2rem; border-bottom: 2px solid #000; padding-bottom: 0.5rem;">The Hearing</h4>
                    <div class="checklist-question">
                        <p>5. Was the hearing manager impartial (not involved in investigation)?</p>
                        <label><input type="radio" name="hearing_impartial" value="yes" required> Yes</label>
                        <label><input type="radio" name="hearing_impartial" value="no"> No</label>
                    </div>
                    <div class="checklist-question">
                        <p>6. Did the employee have opportunity to state their case?</p>
                        <label><input type="radio" name="hearing_case_stated" value="yes" required> Yes</label>
                        <label><input type="radio" name="hearing_case_stated" value="no"> No</label>
                    </div>
                    <div class="checklist-question">
                        <p>7. Was the decision deferred (not decided in the room)?</p>
                        <label><input type="radio" name="decision_deferred" value="yes" required> Yes</label>
                        <label><input type="radio" name="decision_deferred" value="no"> No</label>
                    </div>

                    <h4 style="margin-top: 2rem; border-bottom: 2px solid #000; padding-bottom: 0.5rem;">Outcome</h4>
                    <div class="checklist-question">
                        <p>8. Was the decision in writing?</p>
                        <label><input type="radio" name="decision_in_writing" value="yes" required> Yes</label>
                        <label><input type="radio" name="decision_in_writing" value="no"> No</label>
                    </div>
                    <div class="checklist-question">
                        <p>9. Was a right of appeal offered?</p>
                        <label><input type="radio" name="appeal_right_offered" value="yes" required> Yes</label>
                        <label><input type="radio" name="appeal_right_offered" value="no"> No</label>
                    </div>
                    <div class="checklist-question">
                        <p>10. Was any appeal heard impartially?</p>
                        <label><input type="radio" name="appeal_impartial" value="yes" required> Yes</label>
                        <label><input type="radio" name="appeal_impartial" value="no"> No</label>
                        <label><input type="radio" name="appeal_impartial" value="na"> N/A</label>
                    </div>

                    <button type="button" id="generate-report-btn" class="calc-button" style="margin-top: 2rem;">Generate Report</button>
                </form>
                <div id="checklist-report" class="report-visible" style="display: none; margin-top: 2rem;"></div>
            </section>
        </div>

    </main>

    <div id="cookie-banner" class="cookie-banner">
        <div>We use minimal cookies for analytics.</div>
        <div>
            <button id="btn-accept-cookies" class="cookie-btn">Accept</button>
            <button id="btn-reject-cookies" class="cookie-btn" style="background:transparent; color:#fff; border:1px solid #fff;">Reject</button>
        </div>
    </div>
</div>

<script src="content.js"></script> 

<script>
    /* ==========================================================================
       SITE LOGIC (Do not edit unless changing functionality)
       ========================================================================== */
    
    const CONFIG = { REDUNDANCY_CAP: 719, TAX_YEAR_LABEL: "2025/2026" };
    
    // SPECIFIC PRACTICE AREAS LIST
    const PRACTICE_AREAS = [
        "Restraint of Trade / Non competition / Injunctive Relief",
        "Employment Status",
        "Equality & Discrimination",
        "Equal Pay",
        "Industrial Action & Collective Labour Law",
        "International and Transnational",
        "Pensions Advice & Litigation",
        "Practice & Procedure",
        "Remuneration, Pensions & Benefits",
        "Termination of Employment",
        "TUPE",
        "Whistleblowing & Victimisation"
    ];

    /* ==========================================================================
       ROUTING ENGINE
       ========================================================================== */
    
    // This handles the URL hash (e.g., #profile-view) to allow back-button and direct linking
    function handleRoute() {
        const hash = window.location.hash || '#profile-view'; // Default to profile
        
        // 1. Check if hash matches an article ID (special case)
        const articleMatch = ARTICLES_DATA.find(a => '#' + a.id === hash);
        if (articleMatch) {
            openArticle(articleMatch.id);
            closeMobileMenu();
            return;
        }

        // 2. Hide all pages
        document.querySelectorAll('.page-view').forEach(view => {
            view.style.display = 'none';
        });

        // 3. Remove active state from nav
        document.querySelectorAll('.sidebar-nav a').forEach(link => {
            link.classList.remove('nav-active');
        });

        // 4. Show requested page
        let targetId = hash.replace('#', '');
        // Safety check if ID exists, else default
        const targetView = document.getElementById(targetId) || document.getElementById('profile-view');
        
        targetView.style.display = 'block';
        window.scrollTo(0, 0);

        // 5. Highlight Nav
        const activeLink = document.querySelector(`.sidebar-nav a[data-hash="#${targetId}"]`);
        if (activeLink) activeLink.classList.add('nav-active');
        
        closeMobileMenu();
    }

    // Attach listener for HASH links
    document.querySelectorAll('.sidebar-nav a[data-hash]').forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            window.location.hash = link.getAttribute('data-hash');
        });
    });

    // Listen for browser back/forward buttons
    window.addEventListener('hashchange', handleRoute);

    /* ==========================================================================
       MOBILE MENU LOGIC
       ========================================================================== */
    function toggleMobileMenu() {
        const sidebar = document.getElementById('main-sidebar');
        sidebar.classList.toggle('mobile-open');
    }
    
    function closeMobileMenu() {
        document.getElementById('main-sidebar').classList.remove('mobile-open');
    }

    function toggleSection(element) {
        // Toggle 'expanded' class to rotate arrow and show/hide menu on mobile
        element.classList.toggle('expanded');
    }

    /* --- COOKIES --- */
    function initCookieConsent() {
        const banner = document.getElementById('cookie-banner');
        const consent = localStorage.getItem('cookie_consent');
        if (!consent) { banner.style.display = 'flex'; } 
        else if (consent === 'accepted') { loadAnalytics(); }

        document.getElementById('btn-accept-cookies').addEventListener('click', () => {
            localStorage.setItem('cookie_consent', 'accepted');
            banner.style.display = 'none';
            loadAnalytics();
        });
        document.getElementById('btn-reject-cookies').addEventListener('click', () => {
            localStorage.setItem('cookie_consent', 'rejected');
            banner.style.display = 'none';
        });
    }

    function loadAnalytics() {
        const gtmId = 'GTM-5R5RLDJ'; 
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer', gtmId);
    }
    
    function trackEvent(eventName, params) {
        if (window.dataLayer) { window.dataLayer.push({ 'event': eventName, ...params }); }
    }

    /* --- CASE RENDERING & FILTERING --- */
    function initCases() {
        const typeFilter = document.getElementById('case-type-filter');
        const yearFilter = document.getElementById('case-year-filter');
        const courtFilter = document.getElementById('case-court-filter'); 
        const starredFilter = document.getElementById('case-starred-filter'); 
        const judgeFilter = document.getElementById('case-judge-filter'); 
        const hearingFilter = document.getElementById('case-hearing-type-filter'); 
        const firmFilter = document.getElementById('case-firm-filter'); // NEW
        const textSearch = document.getElementById('case-search-input');
        
        // 1. Populate Type Filter
        const existingTypes = [...new Set(CASES_DATA.map(c => c.type))];
        const allTypes = [...new Set([...PRACTICE_AREAS, ...existingTypes])].sort();

        allTypes.forEach(t => {
            const opt = document.createElement('option');
            opt.value = t;
            opt.innerText = t;
            typeFilter.appendChild(opt);
        });

        // 2. Populate Judge Filter (Dynamic)
        const allJudges = [...new Set(CASES_DATA.map(c => c.judge))].filter(j => j).sort();
        
        allJudges.forEach(j => {
            const opt = document.createElement('option');
            opt.value = j;
            opt.innerText = j;
            judgeFilter.appendChild(opt);
        });

        // 3. Populate Firm Filter (Dynamic & Smart)
        const firms = new Set();
        CASES_DATA.forEach(c => {
            if (c.solicitor && c.solicitor.toLowerCase().includes('direct access')) {
                firms.add("Direct Access");
            } else if (c.firm && c.firm !== 'N/A') {
                firms.add(c.firm);
            }
        });
        const sortedFirms = Array.from(firms).sort();
        
        sortedFirms.forEach(f => {
            const opt = document.createElement('option');
            opt.value = f;
            opt.innerText = f;
            firmFilter.appendChild(opt);
        });

        // Event Listeners
        typeFilter.addEventListener('change', renderCases);
        yearFilter.addEventListener('change', renderCases);
        courtFilter.addEventListener('change', renderCases); 
        starredFilter.addEventListener('change', renderCases); 
        judgeFilter.addEventListener('change', renderCases); 
        hearingFilter.addEventListener('change', renderCases);
        firmFilter.addEventListener('change', renderCases); // NEW
        textSearch.addEventListener('keyup', renderCases);
        
        // Initial Render
        renderCases();
        renderLocations();

        // Report Generator
        document.getElementById('generate-cases-report-btn').addEventListener('click', generateWordReport);
    }

    function renderLocations() {
        // Extract cities/locations from Court names to simulate a map without the complexity
        const locations = new Set();
        CASES_DATA.forEach(c => {
            if(!c.court) return;
            const ct = c.court.toLowerCase();
            if(ct.includes('london')) locations.add('London');
            if(ct.includes('birmingham') || ct.includes('midlands')) locations.add('Birmingham');
            if(ct.includes('leeds')) locations.add('Leeds');
            if(ct.includes('manchester')) locations.add('Manchester');
            if(ct.includes('newcastle')) locations.add('Newcastle');
            if(ct.includes('bristol')) locations.add('Bristol');
            if(ct.includes('wales') || ct.includes('cardiff')) locations.add('Cardiff');
            if(ct.includes('scotland') || ct.includes('glasgow') || ct.includes('edinburgh')) locations.add('Scotland');
            if(ct.includes('liverpool')) locations.add('Liverpool');
            if(ct.includes('leicester')) locations.add('Leicester');
            if(ct.includes('nottingham')) locations.add('Nottingham');
        });

        if(locations.size > 0) {
            const container = document.getElementById('location-pills');
            container.innerHTML = '';
            Array.from(locations).sort().forEach(loc => {
                container.innerHTML += `<span class="loc-pill">${loc}</span>`;
            });
            document.getElementById('location-summary-container').style.display = 'block';
        }
    }

    // Function to highlight search terms
    function highlightText(text, searchTerm) {
        if (!searchTerm) return text;
        const regex = new RegExp(`(${searchTerm})`, 'gi');
        return text.replace(regex, '<span class="search-highlight">$1</span>');
    }

    // Function to handle the click from Judge tags
    window.filterByTerm = function(term) {
        const searchInput = document.getElementById('case-search-input');
        searchInput.value = term;
        // Trigger render
        renderCases();
        document.getElementById('notable-cases').scrollIntoView({ behavior: 'smooth' });
    }

    function renderCases() {
        const container = document.getElementById('cases-list-container');
        const countDisplay = document.getElementById('filter-count-display');
        
        // Gather Filter Inputs
        const typeVal = document.getElementById('case-type-filter').value;
        const yearVal = document.getElementById('case-year-filter').value;
        const courtVal = document.getElementById('case-court-filter').value; 
        const starredVal = document.getElementById('case-starred-filter').checked;
        const judgeVal = document.getElementById('case-judge-filter').value; 
        const hearingVal = document.getElementById('case-hearing-type-filter').value;
        const firmVal = document.getElementById('case-firm-filter').value; // NEW
        
        const searchVal = document.getElementById('case-search-input').value.toLowerCase();
        const currentYear = new Date().getFullYear();

        // Apply timeline class
        container.className = 'case-timeline';
        container.innerHTML = '';

        const filtered = CASES_DATA.filter(c => {
            // 1. Basic Type Match
            const matchesType = (typeVal === 'all') || (c.type === typeVal);
            
            // 2. Year Match (Updated Logic for multiple years)
            let matchesYear = true;
            if (yearVal !== 'all') {
                const caseAge = currentYear - parseInt(c.date, 10);
                matchesYear = caseAge <= parseInt(yearVal, 10);
            }
            
            // 3. Text Search (checks title, description, court, type, and judge)
            const judgeSearch = c.judge ? c.judge.toLowerCase() : '';
            const searchText = `${c.title} ${c.description} ${c.court} ${c.type} ${c.solicitor} ${judgeSearch}`.toLowerCase();
            const matchesSearch = !searchVal || searchText.includes(searchVal);

            // 4. Court Level Match
            let matchesCourt = true;
            if (courtVal !== 'all') {
                const cText = ((c.court || '') + ' ' + (c.type || '')).toLowerCase();
                
                if (courtVal === 'et') {
                    // Matches "Tribunal" but excludes "Appeal"
                    matchesCourt = (cText.includes('employment tribunal') || cText.includes('et ')) && !cText.includes('appeal');
                } else if (courtVal === 'eat') {
                    matchesCourt = cText.includes('eat') || cText.includes('appeal tribunal') || cText.includes('employment appeal');
                } else if (courtVal === 'ca') {
                    matchesCourt = cText.includes('court of appeal') || cText.includes('high court') || cText.includes('ewca') || cText.includes('ewhc');
                } else if (courtVal === 'cc') {
                    matchesCourt = cText.includes('county court');
                }
            }

            // 5. Starred/Notable Match (Updated Label Logic)
            let matchesStarred = true;
            if (starredVal) {
                const caseAge = currentYear - parseInt(c.date, 10);
                matchesStarred = (c.starred === true) && (caseAge <= 3);
            }

            // 6. Judge Match
            let matchesJudge = true;
            if (judgeVal !== 'all') {
                matchesJudge = c.judge === judgeVal;
            }

            // 7. Hearing Type Match
            let matchesHearing = true;
            if (hearingVal !== 'all') {
                const hearingText = ((c.type || '') + ' ' + (c.description || '') + ' ' + (c.significance || '')).toLowerCase();
                if (hearingVal === 'final') {
                    matchesHearing = hearingText.includes('final hearing');
                } else if (hearingVal === 'open_prelim') {
                    matchesHearing = hearingText.includes('open preliminary hearing');
                } else if (hearingVal === 'prelim') {
                    matchesHearing = hearingText.includes('preliminary hearing') && !hearingText.includes('open');
                }
            }

            // 8. Firm Match (NEW)
            let matchesFirm = true;
            if (firmVal !== 'all') {
                if (firmVal === 'Direct Access') {
                    matchesFirm = (c.solicitor && c.solicitor.toLowerCase().includes('direct access')) || (c.firm === 'Direct Access');
                } else {
                    matchesFirm = c.firm === firmVal;
                }
            }

            return matchesType && matchesYear && matchesSearch && matchesCourt && matchesStarred && matchesJudge && matchesHearing && matchesFirm;
        });

        countDisplay.innerText = `${filtered.length} Case${filtered.length !== 1 ? 's' : ''}`;

        if (filtered.length === 0) {
            container.innerHTML = '<p style="color:#777; font-style:italic;">No cases found matching filters.</p>';
            return;
        }

        filtered.forEach(c => {
            const div = document.createElement('div');

            // Simple test to highlight appellate / High Court work
            const isFeatured = /Court of Appeal|High Court|EAT/i.test(c.court || '');
            div.className = isFeatured ? 'case-item case-item--featured' : 'case-item';

            const roleText = c.client ? `For ${c.client}` : '';
            const metaLineParts = [];
            if (c.court) metaLineParts.push(c.court);
            if (c.citation) metaLineParts.push(c.citation);
            const metaLine = metaLineParts.join(' ¬∑ ');

            const solicitorBlock = c.firm 
                ? `${c.solicitor} (${c.firm})`
                : (c.solicitor || '');

            const opposingBlock = c.opposing ? c.opposing : 'Opposing counsel';

            // Determine status style
            let statusStyle = '';
            if(c.status === 'Concluded') statusStyle = 'background-color:#e0f2f1; color:#00695c; border:1px solid #b2dfdb;'; // Greenish
            if(c.status === 'Settled') statusStyle = 'background-color:#fff3e0; color:#e65100; border:1px solid #ffe0b2;'; // Orangeish

            // --- Highlight content if search is active ---
            let title = c.title;
            let description = c.description;
            let judge = c.judge || '';
            let solicitor = solicitorBlock;
            
            if (searchVal) {
                 title = highlightText(title, searchVal);
                 description = highlightText(description, searchVal);
                 judge = highlightText(judge, searchVal);
                 solicitor = highlightText(solicitor, searchVal);
            }

            // Case Law logic
            let caseLawHtml = '';
            if(c.key_case_law && c.key_case_law.length > 0) {
                 caseLawHtml = `
                    <div class="case-law-section">
                        <span class="case-law-label">Key Authorities Cited</span>
                        <div class="case-badges-row" style="margin-top:0;">
                             ${c.key_case_law.map(law => `<span class="case-tag law-tag">${law}</span>`).join('')}
                        </div>
                    </div>
                 `;
            }

            // Clean judge name for onclick to avoid quote issues
            const safeJudge = (c.judge || '').replace(/'/g, "\\'");
            const judgeTag = c.judge 
                ? `<span class="case-tag clickable-tag" onclick="filterByTerm('${safeJudge}')" title="Filter by this Judge"><strong>Judge:</strong> ${judge}</span>` 
                : '';

            div.innerHTML = `
                <div class="case-node"></div>
                <div class="case-year-label">${c.date}</div>

                <div class="case-header">
                    <div class="case-header-main">
                        <h3 class="case-title">${title}</h3>
                        <div class="case-strapline">
                            ${c.significance || ''}${c.significance && roleText ? ' ¬∑ ' : ''}${roleText}
                        </div>
                    </div>
                    <div class="case-meta-block">
                        <span class="case-type-pill">${c.type}</span>
                        <span class="case-meta">${metaLine}</span>
                    </div>
                </div>

                <p>${description}</p>
                
                ${caseLawHtml}

                <div class="case-badges-row">
                    ${judgeTag}
                    ${solicitor ? `<span class="case-tag"><strong>Solicitor:</strong> ${solicitor}</span>` : ''}
                    ${opposingBlock && opposingBlock !== 'N/A' ? `<span class="case-tag"><strong>Opp:</strong> ${opposingBlock}</span>` : ''}
                    ${c.status ? `<span class="case-tag" style="${statusStyle}"><strong>Status:</strong> ${c.status}</span>` : ''}
                </div>
            `;

            container.appendChild(div);
        });
    }

    /* --- WORD DOCUMENT GENERATION (Client-Side) --- */
    function generateWordReport() {
        const { Document, Packer, Paragraph, Table, TableCell, TableRow, WidthType, HeadingLevel, TextRun } = docx;

        // 1. RE-RUN FILTER LOGIC TO GET DATA (Must match renderCases logic exactly)
        const typeVal = document.getElementById('case-type-filter').value;
        const yearVal = document.getElementById('case-year-filter').value;
        const courtVal = document.getElementById('case-court-filter').value; 
        const starredVal = document.getElementById('case-starred-filter').checked;
        const judgeVal = document.getElementById('case-judge-filter').value;
        const hearingVal = document.getElementById('case-hearing-type-filter').value;
        const firmVal = document.getElementById('case-firm-filter').value; // NEW
        const searchVal = document.getElementById('case-search-input').value.toLowerCase();
        const currentYear = new Date().getFullYear();

        const filteredCases = CASES_DATA.filter(c => {
            const matchesType = (typeVal === 'all') || (c.type === typeVal);
            
            let matchesYear = true;
            if (yearVal !== 'all') {
                const caseAge = currentYear - parseInt(c.date, 10);
                matchesYear = caseAge <= parseInt(yearVal, 10);
            }
            
            const judgeSearch = c.judge ? c.judge.toLowerCase() : '';
            const searchText = `${c.title} ${c.description} ${c.court} ${c.type} ${c.solicitor} ${judgeSearch}`.toLowerCase();
            const matchesSearch = !searchVal || searchText.includes(searchVal);

            let matchesCourt = true;
            if (courtVal !== 'all') {
                const cText = ((c.court || '') + ' ' + (c.type || '')).toLowerCase();
                if (courtVal === 'et') matchesCourt = (cText.includes('employment tribunal') || cText.includes('et ')) && !cText.includes('appeal');
                else if (courtVal === 'eat') matchesCourt = cText.includes('eat') || cText.includes('appeal tribunal') || cText.includes('employment appeal');
                else if (courtVal === 'ca') matchesCourt = cText.includes('court of appeal') || cText.includes('high court') || cText.includes('ewca') || cText.includes('ewhc');
                else if (courtVal === 'cc') matchesCourt = cText.includes('county court');
            }

            let matchesStarred = true;
            if (starredVal) {
                const caseAge = currentYear - parseInt(c.date, 10);
                matchesStarred = (c.starred === true) && (caseAge <= 3);
            }

            let matchesJudge = true;
            if (judgeVal !== 'all') {
                matchesJudge = c.judge === judgeVal;
            }

            let matchesHearing = true;
            if (hearingVal !== 'all') {
                const hearingText = ((c.type || '') + ' ' + (c.description || '') + ' ' + (c.significance || '')).toLowerCase();
                if (hearingVal === 'final') matchesHearing = hearingText.includes('final hearing');
                else if (hearingVal === 'open_prelim') matchesHearing = hearingText.includes('open preliminary hearing');
                else if (hearingVal === 'prelim') matchesHearing = hearingText.includes('preliminary hearing') && !hearingText.includes('open');
            }

            let matchesFirm = true;
            if (firmVal !== 'all') {
                if (firmVal === 'Direct Access') {
                    matchesFirm = (c.solicitor && c.solicitor.toLowerCase().includes('direct access')) || (c.firm === 'Direct Access');
                } else {
                    matchesFirm = c.firm === firmVal;
                }
            }

            return matchesType && matchesYear && matchesSearch && matchesCourt && matchesStarred && matchesJudge && matchesHearing && matchesFirm;
        });

        if (filteredCases.length === 0) {
            alert("No cases match your current filters.");
            return;
        }

        // 2. BUILD WORD DOCUMENT ROWS
        const tableRows = [
            new TableRow({
                children: [
                    new TableCell({ children: [new Paragraph({ text: "Year", bold: true })], width: { size: 10, type: WidthType.PERCENTAGE } }),
                    new TableCell({ children: [new Paragraph({ text: "Case / Citation", bold: true })], width: { size: 25, type: WidthType.PERCENTAGE } }),
                    new TableCell({ children: [new Paragraph({ text: "Details", bold: true })], width: { size: 45, type: WidthType.PERCENTAGE } }),
                    new TableCell({ children: [new Paragraph({ text: "Outcome/Status", bold: true })], width: { size: 20, type: WidthType.PERCENTAGE } }),
                ],
            }),
        ];

        filteredCases.forEach(c => {
            tableRows.push(
                new TableRow({
                    children: [
                        new TableCell({ children: [new Paragraph(c.date)] }),
                        new TableCell({ 
                            children: [
                                new Paragraph({ text: c.title, bold: true }),
                                new Paragraph(c.citation || ""),
                                new Paragraph({ text: c.court || "", italics: true })
                            ] 
                        }),
                        new TableCell({ 
                            children: [
                                new Paragraph(c.description),
                                new Paragraph({ text: `\nSolicitor: ${c.solicitor || "N/A"}`, size: 16, color: "555555" }) // size in half-points
                            ] 
                        }),
                        new TableCell({ children: [new Paragraph(c.status || "Concluded")] }),
                    ],
                })
            );
        });

        // 3. CREATE DOCUMENT
        const doc = new Document({
            sections: [{
                properties: {},
                children: [
                    new Paragraph({
                        text: "Alex MacMillan - Case Report",
                        heading: HeadingLevel.HEADING_1,
                    }),
                    new Paragraph({
                        text: `Generated on ${new Date().toLocaleDateString()} | Filter Applied: ${typeVal}`,
                        spacing: { after: 400 },
                    }),
                    new Table({
                        rows: tableRows,
                        width: { size: 100, type: WidthType.PERCENTAGE },
                    }),
                ],
            }],
        });

        // 4. GENERATE AND SAVE
        Packer.toBlob(doc).then(blob => {
            saveAs(blob, "Alex_MacMillan_Case_Report.docx");
        });
    }

    /* --- ARTICLE LOGIC --- */
    function renderArticlesHub() {
        const container = document.getElementById('articles-grid-container');
        const homeInsightContainer = document.getElementById('home-latest-insight-container');
        
        // 1. Render Main Hub (All Articles)
        container.innerHTML = '';
        ARTICLES_DATA.forEach(article => {
            const card = document.createElement('div');
            card.className = 'article-card';
            card.onclick = () => window.location.hash = '#' + article.id; // Hash linking
            card.innerHTML = `<div><h3>${article.title}</h3><div class="article-date">${article.date}</div><div style="font-size:0.9rem; color:#555;">${article.summary}</div></div><div class="read-more-link">Read Entry ‚Üí</div>`;
            container.appendChild(card);
        });

        // 2. Render Latest Insights on Home (Show 3)
        if (ARTICLES_DATA.length > 0 && homeInsightContainer) {
            // Get the first 3 articles
            const recentArticles = ARTICLES_DATA.slice(0, 3);
            
            // Add a sub-header
            let html = '<h3 style="margin-bottom: 1rem; border-bottom: none; color: var(--text-muted); font-size: 1rem; text-transform: uppercase; letter-spacing: 0.05em;">Recent Updates</h3>';
            
            // Open Grid Container (Reusing your existing 'article-grid' class for layout)
            html += '<div class="article-grid" style="border-top: 1px solid var(--line-color); border-left: 1px solid var(--line-color);">';

            // Loop through the 3 recent articles
            recentArticles.forEach(article => {
                html += `
                    <div class="article-card" onclick="window.location.hash = '#${article.id}'">
                        <div>
                            <span class="latest-insight-label">${article.date}</span>
                            <h3 style="font-size: 1.4rem; margin: 0.5rem 0; line-height: 1.2;">${article.title}</h3>
                            <p style="font-size:0.95rem; color:#444;">${article.summary}</p>
                        </div>
                        <div class="read-more-link" style="margin-top:1rem;">Read Full Article ‚Üí</div>
                    </div>
                `;
            });

            html += '</div>'; // Close Grid
            
            homeInsightContainer.innerHTML = html;
        }
    }

    function openArticle(id) {
        const article = ARTICLES_DATA.find(a => a.id === id);
        if (!article) return;
        document.title = article.title;
        trackEvent('view_article', { article_id: id });
        
        // Dynamic Content Construction
        let htmlContent = `<h1>${article.title}</h1>`;
        htmlContent += `<div class="subtitle">${article.date}</div>`;
        
        // --- VIDEO CONDITIONAL RENDER ---
        if (article.videoEmbed) {
            htmlContent += `<div class="video-responsive">${article.videoEmbed}</div>`;
        }

        htmlContent += article.content;

        document.getElementById('article-reader-content').innerHTML = htmlContent;
        
        // Navigation Logic
        document.querySelectorAll('.page-view').forEach(view => view.style.display = 'none');
        document.getElementById('article-reader-view').style.display = 'block';
        window.scrollTo(0,0);
    }

    function showPage(pageId) {
        // Fallback for direct calls not using hash
        window.location.hash = '#' + pageId;
    }

    /* --- CALCULATORS --- */
    function initPayCalculators() {
        document.getElementById('calculate-hp-btn').addEventListener('click', calculateHolidayPay);
        document.getElementById('calculate-rp-btn').addEventListener('click', calculateRedundancyPay);
        document.getElementById('calculate-np-btn').addEventListener('click', calculateNoticePay);
    }

    function calculateHolidayPay() {
        const totalPay = parseFloat(document.getElementById('hp-total-pay').value);
        const weeksWorked = parseFloat(document.getElementById('hp-weeks-worked').value);
        const resultsDiv = document.getElementById('hp-results');
        resultsDiv.style.display = 'block';
        
        if (isNaN(totalPay) || isNaN(weeksWorked) || weeksWorked <= 0) {
            resultsDiv.innerHTML = `<div class="error-message">Please enter valid figures.</div>`; return;
        }
        
        const avg = totalPay / weeksWorked;
        const total = avg * 5.6;
        
        resultsDiv.innerHTML = `
            <div class="pay-result-box">
                <div class="subtitle">Estimated Statutory Entitlement</div>
                <div class="result-headline">¬£${total.toFixed(2)}</div>
                <p>Based on average weekly pay of ¬£${avg.toFixed(2)}</p>
            </div>
            <button class="print-btn" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>
        `;
    }

    function calculateRedundancyPay() {
        const dob = new Date(document.getElementById('rp-dob').value);
        const start = new Date(document.getElementById('rp-start-date').value);
        const end = new Date(document.getElementById('rp-end-date').value);
        const pay = parseFloat(document.getElementById('rp-weekly-pay').value);
        const resultsDiv = document.getElementById('rp-results');
        resultsDiv.style.display = 'block';

        if (isNaN(dob) || isNaN(start) || isNaN(end) || isNaN(pay)) {
            resultsDiv.innerHTML = `<div class="error-message">Please check dates and pay.</div>`; return;
        }

        const serviceYears = Math.floor((end - start) / (365.25 * 24 * 60 * 60 * 1000));
        if (serviceYears < 2) { resultsDiv.innerHTML = `<div class="error-message">2 years service required.</div>`; return; }

        const cappedYears = Math.min(serviceYears, 20);
        const cappedPay = Math.min(pay, CONFIG.REDUNDANCY_CAP);
        let weeks = 0;

        for (let i = 0; i < cappedYears; i++) {
            const age = Math.floor((end - dob) / (365.25 * 86400000)) - i;
            if (age >= 41) weeks += 1.5;
            else if (age >= 22) weeks += 1.0;
            else weeks += 0.5;
        }
        
        const total = weeks * cappedPay;
        resultsDiv.innerHTML = `
            <div class="pay-result-box">
                <div class="subtitle">Statutory Redundancy Pay</div>
                <div class="result-headline">¬£${total.toFixed(2)}</div>
                <p>${weeks} weeks @ ¬£${cappedPay.toFixed(2)}</p>
            </div>
            <button class="print-btn" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>
        `;
    }

    /* --- NOTICE PAY CALCULATOR (IDS LOGIC) --- */
    function calculateNoticePay() {
        const start = new Date(document.getElementById('np-start-date').value);
        const end = new Date(document.getElementById('np-end-date').value);
        const contractWeeks = parseFloat(document.getElementById('np-contract-notice').value);
        const pay = parseFloat(document.getElementById('np-weekly-pay').value);
        const resultsDiv = document.getElementById('np-results');
        resultsDiv.style.display = 'block';

        if (isNaN(start) || isNaN(end) || isNaN(contractWeeks) || isNaN(pay)) {
            resultsDiv.innerHTML = `<div class="error-message">Please fill all fields.</div>`; return;
        }

        const serviceYears = Math.floor((end - start) / (365.25 * 24 * 60 * 60 * 1000));
        let statNoticeWeeks = 0;

        // S.86 ERA Rules
        if (serviceYears < 1/12) statNoticeWeeks = 0;
        else if (serviceYears < 2) statNoticeWeeks = 1;
        else if (serviceYears < 12) statNoticeWeeks = serviceYears;
        else statNoticeWeeks = 12;

        const threshold = statNoticeWeeks + 1;
        let html = '';
        
        if (contractWeeks >= threshold) {
             // S.87(4) Disapplies Stat Pay
             html = `
                <div class="pay-result-box" style="background-color: #fdf6f6; border-left-color: #d32f2f;">
                    <div class="subtitle" style="color:#d32f2f;">Statutory Notice Pay does NOT apply</div>
                    <p style="font-size:1.2rem; font-weight:600;">You must rely on your contract terms.</p>
                    <p><strong>Reason:</strong> Your contractual notice (${contractWeeks} weeks) is at least 1 week longer than your statutory entitlement (${statNoticeWeeks} weeks). Under S.87(4) ERA 1996, the statutory full pay guarantee does not apply.</p>
                </div>
             `;
        } else {
            // Statutory Pay Applies
            const total = statNoticeWeeks * pay;
            html = `
                <div class="pay-result-box" style="background-color: #f0fff4; border-left-color: #2d6a4f;">
                    <div class="subtitle" style="color:#2d6a4f;">Statutory Notice Pay Applies</div>
                    <div class="result-headline">¬£${total.toFixed(2)}</div>
                    <p><strong>Reason:</strong> Contractual notice (${contractWeeks} weeks) is NOT at least 1 week longer than statutory entitlement (${statNoticeWeeks} weeks).</p>
                    <p>You are entitled to full pay for the ${statNoticeWeeks} weeks of statutory notice (S.88/89 ERA), even if you are off sick or on leave (subject to mitigation/deductions).</p>
                </div>
            `;
        }
        
        html += `<button class="print-btn" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>`;
        resultsDiv.innerHTML = html;
    }

    /* --- LIMITATION CALCULATOR --- */
    function initLimitationCalculator() {
        const respondentsContainer = document.getElementById('respondents-container');
        document.getElementById('add-respondent-btn').addEventListener('click', () => {
             const div = document.createElement('div');
             div.className = 'calculator-grid';
             div.style.marginBottom = "1rem";
             div.innerHTML = `<div><label>EC Start (Day A)</label><input type="date" class="ec-start-date"></div><div><label>EC Certificate (Day B)</label><input type="date" class="ec-cert-date"></div>`;
             respondentsContainer.appendChild(div);
        });
        document.getElementById('calculate-btn').addEventListener('click', computeLimitation);
    }

    function computeLimitation() {
        const eventDate = new Date(document.getElementById('event_date').value);
        if (isNaN(eventDate)) { alert("Enter EDT"); return; }
        
        const months = parseInt(document.getElementById('claim_type').value);
        const primary = new Date(eventDate);
        primary.setMonth(primary.getMonth() + months);
        primary.setDate(primary.getDate() - 1); // Exact corresponding date minus one day
        
        const rows = document.querySelectorAll('.ec-start-date');
        const tbody = document.getElementById('results-table-body');
        tbody.innerHTML = '';
        
        rows.forEach((row, idx) => {
             const start = new Date(row.value);
             const end = new Date(row.parentElement.nextElementSibling.querySelector('input').value);
             if(isNaN(start) || isNaN(end)) return;

             let deadline = new Date(primary);
             let method = "Primary Deadline";

             // Standard ACAS Pause Logic (simplified implementation)
             // 1. Stop the clock during conciliation
             if (start <= primary) {
                 const pause = Math.round((end - start) / (1000*60*60*24));
                 deadline.setDate(deadline.getDate() + pause);
                 method = `s.207B(3) (+${pause} days)`;
             }
             
             // 2. "Month rule" check: if deadline < 1 month after Day B, extend to 1 month after Day B
             const monthAfterDayB = new Date(end);
             monthAfterDayB.setMonth(monthAfterDayB.getMonth() + 1);
             
             if (deadline < monthAfterDayB) {
                 deadline = monthAfterDayB;
                 method = "s.207B(4) (1 month after Day B)";
             }
             
             tbody.innerHTML += `<tr><td>Respondent ${idx+1}</td><td><strong>${deadline.toLocaleDateString('en-GB')}</strong></td><td>${method}</td></tr>`;
        });
        
        document.getElementById('limitation-calculator-results').style.display = 'block';
    }

    /* --- DISCIPLINARY REPORT --- */
    function initDisciplinaryChecklist() {
        document.getElementById('generate-report-btn').addEventListener('click', () => {
            const form = document.getElementById('disciplinary-checklist-form');
            if(!form.checkValidity()) { alert("Please answer all questions"); return; }
            
            // Logic: Count "No" answers
            const formData = new FormData(form);
            let risks = [];
            
            // Map simple logic
            if(formData.get('investigation_conducted') === 'no') risks.push("Failure to investigate");
            if(formData.get('notification_written') === 'no') risks.push("No written notification");
            if(formData.get('right_to_be_accompanied') === 'no') risks.push("Right to accompany denied");
            if(formData.get('hearing_impartial') === 'no') risks.push("Hearing manager not impartial");
            
            const div = document.getElementById('checklist-report');
            div.style.display = 'block';
            
            let html = '';
            if(risks.length > 0) {
                html = `<div class="report-red"><h4>Risks Identified</h4><ul>${risks.map(r => `<li>${r}</li>`).join('')}</ul></div>`;
            } else {
                html = `<div class="report-green"><h4>Procedure Sound</h4><p>Based on inputs, the procedure aligns with ACAS Code.</p></div>`;
            }
            html += `<button class="print-btn" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>`;
            div.innerHTML = html;
        });
    }

    /* --- TESTIMONIALS CAROUSEL --- */
    function initTestimonialsCarousel() {
        const wrapper = document.getElementById('testimonials-wrapper');
        const prevBtn = document.getElementById('prev-testimonial');
        const nextBtn = document.getElementById('next-testimonial');
        
        if (!wrapper || !prevBtn || !nextBtn || typeof TESTIMONIALS_DATA === 'undefined' || TESTIMONIALS_DATA.length === 0) {
            return;
        }

        let currentIndex = 0;

        function renderTestimonials() {
            wrapper.innerHTML = '';
            TESTIMONIALS_DATA.forEach(t => {
                const slide = document.createElement('div');
                slide.className = 'testimonial-slide';
                slide.innerHTML = `
                    <div class="testimonial-text">"${t.text}"</div>
                    <div class="testimonial-author">‚Äî ${t.author}, ${t.firm}</div>
                `;
                wrapper.appendChild(slide);
            });
            updateCarousel();
        }

        function updateCarousel() {
            const width = wrapper.clientWidth;
            wrapper.style.transform = `translateX(-${currentIndex * 100}%)`;
        }

        nextBtn.addEventListener('click', () => {
            currentIndex = (currentIndex + 1) % TESTIMONIALS_DATA.length;
            updateCarousel();
        });

        prevBtn.addEventListener('click', () => {
            currentIndex = (currentIndex - 1 + TESTIMONIALS_DATA.length) % TESTIMONIALS_DATA.length;
            updateCarousel();
        });
        
        // Initial render
        renderTestimonials();
        
        // Handle window resize for carousel width
        window.addEventListener('resize', updateCarousel);
    }

    // INIT
    document.addEventListener('DOMContentLoaded', () => {
        initCookieConsent();
        initCases(); 
        renderArticlesHub();
        initPayCalculators();
        initLimitationCalculator(); 
        initDisciplinaryChecklist(); 
        initTestimonialsCarousel(); // Initialize carousel
        
        // Initial Routing Check
        handleRoute();
        
        // Trigger default respondent row for Limitation Calc
        if(document.getElementById('add-respondent-btn')) {
             document.getElementById('add-respondent-btn').click();
        }
    });
</script>

</body>
</html>
