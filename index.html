<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alex MacMillan | Employment Law Barrister</title>
    <meta name="description" content="The professional website for Alex MacMillan, a UK-based employment law barrister. Specialist in discrimination, whistleblowing, and TUPE.">
    <meta property="og:type" content="website">
    
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@300;400;500;600&family=Space+Grotesk:wght@300;400;500&display=swap" rel="stylesheet">

    <style>
        /* CORE VARIABLES & RESET */
        :root { --bg-color: #F2F2F0; --panel-bg: #FFFFFF; --text-main: #111111; --text-muted: #555555; --line-color: #D1D1D1; --sidebar-width: 320px; --font-sans: 'Inter', sans-serif; --font-mono: 'Space Grotesk', monospace; --font-serif: 'DM Serif Display', serif; }
        body { font-family: var(--font-sans); background-color: var(--bg-color); color: var(--text-main); margin: 0; line-height: 1.5; -webkit-font-smoothing: antialiased; }
        * { box-sizing: border-box; }

        /* LAYOUT */
        .site-wrapper { display: flex; min-height: 100vh; }
        .sidebar { width: var(--sidebar-width); background-color: var(--bg-color); border-right: 1px solid var(--line-color); position: fixed; height: 100vh; padding: 2.5rem; display: flex; flex-direction: column; justify-content: space-between; top: 0; left: 0; overflow-y: auto; z-index: 100; transition: transform 0.3s ease; }
        .main-content { margin-left: var(--sidebar-width); width: calc(100% - var(--sidebar-width)); background-color: var(--panel-bg); min-height: 100vh; }
        
        /* TYPOGRAPHY */
        h1, h2, h3 { font-family: var(--font-serif); color: var(--text-main); font-weight: 400; margin-top: 0; }
        h1 { font-size: 2.5rem; line-height: 1.1; margin-bottom: 0.5rem; }
        h2 { font-size: 3rem; border-bottom: 1px solid var(--line-color); padding-bottom: 1.5rem; margin-bottom: 2rem; }
        .subtitle { font-family: var(--font-mono); font-size: 0.85rem; letter-spacing: 0.05em; text-transform: uppercase; color: var(--text-muted); display: block; margin-bottom: 2rem; }
        p { font-size: 1.05rem; color: #333; max-width: 700px; margin-bottom: 1.5rem; }

        /* NAVIGATION & SIDEBAR SECTIONS */
        .nav-section { margin-bottom: 3rem; }
        .nav-label { font-family: var(--font-mono); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: #888; margin-bottom: 1rem; display: block; cursor: pointer; }
        .sidebar-nav a { display: block; font-family: var(--font-sans); font-size: 1rem; text-decoration: none; color: var(--text-muted); padding: 0.5rem 0; transition: 0.3s; cursor: pointer; }
        .sidebar-nav a:hover, .sidebar-nav a.nav-active { color: var(--text-main); font-weight: 500; border-bottom: 1px solid var(--text-main); display: inline-block; }
        
        .contact-email { font-family: var(--font-mono); font-size: 0.85rem; margin-top: 1rem; display: block; color: var(--text-main); }
        .testimonial-box { font-style: italic; font-family: var(--font-serif); font-size: 1.2rem; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--line-color); }

        /* PROFILE SECTION STYLES */
        #about p { font-size: 1.1rem; line-height: 1.6; }
        
        /* TESTIMONIALS CAROUSEL */
        .testimonials-container { margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--line-color); position: relative; overflow: hidden; }
        .testimonials-wrapper { display: flex; transition: transform 0.5s ease-in-out; }
        .testimonial-slide { min-width: 100%; padding: 1rem; box-sizing: border-box; }
        .testimonial-text { font-family: var(--font-serif); font-size: 1.3rem; line-height: 1.5; color: var(--text-main); font-style: italic; margin-bottom: 1rem; }
        .testimonial-author { font-family: var(--font-sans); font-size: 0.9rem; color: var(--text-muted); font-weight: 500; }
        .testimonial-controls { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1rem; }
        .control-btn { background: none; border: 1px solid var(--line-color); color: var(--text-muted); width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1rem; transition: all 0.2s; }
        .control-btn:hover { border-color: var(--text-main); color: var(--text-main); }

        /* LATEST INSIGHT BOX */
        .article-card { border: 1px solid #eee; padding: 1.5rem; margin-bottom: 1rem; cursor: pointer; transition: 0.2s; }
        .article-card:hover { background: #fafafa; border-color: #ddd; }
        .article-card h3 { font-size: 1.4rem; margin: 0.5rem 0; }
        .article-date { font-family: var(--font-mono); font-size: 0.75rem; color: #888; text-transform: uppercase; }
        .read-more-link { font-family: var(--font-mono); font-size: 0.8rem; text-transform: uppercase; margin-top: 1rem; display: block; }

        /* CASES & TIMELINE */
        .case-timeline { position: relative; margin-top: 2rem; padding-left: 1.5rem; }
        .case-timeline::before { content: ""; position: absolute; left: 14px; top: 0; bottom: 0; width: 1px; background: var(--line-color); }
        .case-item { position: relative; margin-left: 1.5rem; padding: 1.75rem 0 1.75rem 1.75rem; border-bottom: 1px solid var(--line-color); }
        
        .case-item--featured { 
            background-color: #FCFCFC; 
            border: 1px solid #DCDCDC; 
            border-left: 4px solid var(--text-main); 
            padding: 2rem 1.75rem; 
            margin-bottom: 1rem; 
            margin-left: 1.5rem; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.05); 
        }

        .case-node { position: absolute; left: -2.25rem; top: 2.2rem; width: 12px; height: 12px; border-radius: 999px; background: #FFFFFF; border: 2px solid var(--text-main); z-index: 10; }
        .case-item--featured .case-node { background-color: var(--text-main); }
        .case-year-label { position: absolute; left: -4.5rem; top: 1.85rem; font-family: var(--font-mono); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-muted); }
        
        .case-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 1.5rem; margin-bottom: 0.5rem; flex-wrap: wrap; }
        .case-title { font-family: var(--font-serif); font-size: 1.5rem; margin: 0; line-height: 1.2; color: var(--text-main); }
        .case-strapline { font-size: 0.9rem; color: #555; font-family: var(--font-mono); }
        
        .case-meta-block { text-align: right; }
        .case-meta { font-family: var(--font-mono); font-size: 0.75rem; text-transform: uppercase; color: #777; margin-bottom: 2px; }
        .clickable-meta { cursor: pointer; transition: all 0.2s ease; border-bottom: 1px dotted transparent; }
        .clickable-meta:hover { color: var(--text-main); border-bottom-color: var(--text-main); }

        /* BADGES */
        .case-badges-row { display: flex; flex-wrap: wrap; gap: 0.4rem; margin-top: 1rem; align-items: center; }
        .case-tag { display: inline-flex; align-items: center; padding: 0.25rem 0.65rem; border-radius: 4px; background-color: #EFEFEF; font-family: var(--font-mono); font-size: 0.75rem; color: #444; transition: all 0.2s ease; position: relative; }
        .case-tag strong { color: #000; margin-right: 4px; font-weight: 500; }
        .clickable-badge { cursor: pointer; border-bottom: 1px solid transparent; }
        .clickable-badge:hover { filter: brightness(0.95); transform: translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .jurisdiction-tag { background-color: #e3f2fd; color: #0d47a1; border: 1px solid #bbdefb; }
        .law-tag { background-color: #fff3e0; color: #e65100; border: 1px solid #ffe0b2; }
        
        /* COPY BUTTON */
        .copy-btn { border: 1px solid var(--line-color); background: #fff; border-radius: 4px; padding: 0.25rem 0.5rem; font-family: var(--font-mono); font-size: 0.7rem; cursor: pointer; color: #666; transition: all 0.2s; margin-left: auto; display: flex; align-items: center; gap: 4px; }
        .copy-btn:hover { background: #333; color: #fff; border-color: #333; }
        .copy-btn:active { transform: translateY(1px); }

        /* TOOLTIPS */
        .case-tooltip-popup { visibility: hidden; width: 280px; background-color: #222; color: #fff; text-align: center; border-radius: 4px; padding: 0.8rem; position: absolute; z-index: 1000; bottom: 135%; left: 50%; transform: translateX(-50%); opacity: 0; transition: opacity 0.3s; font-family: var(--font-sans); font-size: 0.85rem; line-height: 1.4; pointer-events: none; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .case-tooltip-popup::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -6px; border-width: 6px; border-style: solid; border-color: #222 transparent transparent transparent; }
        .case-tag:hover .case-tooltip-popup { visibility: visible; opacity: 1; transform: translateX(-50%) translateY(-5px); }

        /* KNOWLEDGE CARD */
        .knowledge-card { position: relative; background-color: #fff; border: 1px solid var(--text-main); border-left: 5px solid var(--text-main); padding: 1.5rem; margin-bottom: 2rem; display: none; animation: fadeIn 0.4s ease-in-out; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .knowledge-card h4 { margin-top: 0; margin-bottom: 0.5rem; color: var(--text-main); font-family: var(--font-serif); font-size: 1.4rem; }
        .knowledge-card-close { position: absolute; top: 0.5rem; right: 0.5rem; background: none; border: none; font-size: 1.2rem; cursor: pointer; color: #999; }
        .knowledge-card-close:hover { color: #000; }

        /* FILTERS */
        .filters-toolbar { display: flex; gap: 1rem; margin-bottom: 2rem; padding: 1.5rem; background: #FAFAFA; border: 1px solid var(--line-color); align-items: center; flex-wrap: wrap; }
        .filter-group { display: flex; flex-direction: column; gap: 0.5rem; flex-grow: 1; min-width: 200px; }
        .filter-select, .search-input, .autocomplete-input { padding: 0.6rem; border: 1px solid #ccc; font-family: var(--font-mono); font-size: 0.9rem; background-color: #fff; width: 100%; border-radius: 0; appearance: none; }
        .clear-filters-btn { background-color: #fff; border: 1px solid #999; color: #333; font-family: var(--font-mono); font-size: 0.8rem; padding: 0.5rem 1rem; cursor: pointer; margin-left: auto; text-transform: uppercase; transition: all 0.2s; }
        .clear-filters-btn:hover { background-color: #333; color: #fff; }
        .help-tip { cursor: help; text-decoration: underline dotted #aaa; }

        /* SECTIONS */
        section { padding: 4rem 4rem 6rem 4rem; border-bottom: 1px solid var(--line-color); }

        /* CALCULATORS & UTILS */
        .calculator-inputs { margin-bottom: 3rem; max-width: 800px; }
        .calculator-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 2rem; margin-bottom: 1.5rem; }
        input[type="text"], input[type="number"], input[type="date"], select { width: 100%; padding: 0.8rem 0; border: none; border-bottom: 1px solid var(--text-main); background: transparent; font-family: var(--font-mono); font-size: 1.1rem; color: var(--text-main); border-radius: 0; }
        input:focus, select:focus { outline: none; border-bottom: 2px solid var(--text-main); background-color: #FAFAFA; }
        label { display: block; font-family: var(--font-sans); font-size: 0.8rem; color: #666; margin-bottom: 0.2rem; }
        .calc-button { font-family: var(--font-mono); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.1em; background: transparent; color: var(--text-main); border: 1px solid var(--text-main); padding: 1rem 2rem; cursor: pointer; transition: all 0.2s; margin-top: 1rem; width: auto; display: inline-block; }
        .calc-button:hover { background: var(--text-main); color: #fff; }
        .pay-result-box { background: #F9F9F9; padding: 2rem; border-left: 4px solid var(--text-main); margin-top: 2rem; }
        .result-headline { font-family: var(--font-mono); font-size: 3rem; margin: 1rem 0; }
        .error-message { color: #D00; font-family: var(--font-mono); margin: 1rem 0; }
        
        /* BACK TO TOP */
        .back-to-top { position: fixed; bottom: 2rem; right: 2rem; width: 45px; height: 45px; background: var(--text-main); color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0; pointer-events: none; transition: all 0.3s; z-index: 500; font-size: 1.2rem; border: none; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .back-to-top.visible { opacity: 1; pointer-events: auto; }
        .back-to-top:hover { transform: translateY(-3px); background: #000; }

        /* COOKIE BANNER */
        .cookie-banner { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; border-top: 1px solid #ccc; padding: 1rem 2rem; z-index: 2000; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); transform: translateY(100%); transition: transform 0.4s ease-out; }
        .cookie-banner.active { transform: translateY(0); }
        .cookie-text { font-family: var(--font-sans); font-size: 0.9rem; color: #444; max-width: 800px; margin-right: 1rem; }
        .cookie-actions { display: flex; gap: 1rem; }
        .cookie-btn { padding: 0.5rem 1rem; font-family: var(--font-mono); font-size: 0.8rem; text-transform: uppercase; cursor: pointer; border: 1px solid #333; background: transparent; transition: all 0.2s; }
        .cookie-btn.accept { background: #333; color: #fff; }
        .cookie-btn:hover { opacity: 0.8; }
        
        /* FIX: MOBILE OVERLAY */
        .menu-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 250; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
        .menu-overlay.active { opacity: 1; pointer-events: auto; }

        /* MOBILE */
        .mobile-menu-toggle { display: none; }
        @media (max-width: 900px) {
            .site-wrapper { flex-direction: column; }
            .sidebar { position: fixed; width: 100%; transform: translateX(-100%); z-index: 300; border-right: none; }
            .sidebar.mobile-open { transform: translateX(0); }
            .main-content { margin-left: 0; width: 100%; }
            .mobile-menu-toggle { display: flex; justify-content: space-between; padding: 1rem; background: var(--bg-color); border-bottom: 1px solid var(--line-color); position: sticky; top: 0; z-index: 200; }
            .filters-toolbar { flex-direction: column; align-items: stretch; }
            section { padding: 2rem; }
            .back-to-top { bottom: 1.5rem; right: 1.5rem; }
            .cookie-banner { flex-direction: column; align-items: flex-start; gap: 1rem; }
            .cookie-text { margin-right: 0; }
        }
        
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="site-wrapper">
    <div class="menu-overlay" id="menu-overlay" onclick="toggleMobileMenu()"></div>

    <div class="mobile-menu-toggle">
        <h1 style="font-size:1.2rem; margin:0;">Alex MacMillan</h1>
        <button onclick="toggleMobileMenu()" style="background:none; border:1px solid #000; padding:0.4rem; font-family:var(--font-mono);">MENU</button>
    </div>

    <aside class="sidebar" id="main-sidebar">
        <button onclick="toggleMobileMenu()" style="align-self:flex-end; background:none; border:none; font-size:1.5rem; cursor:pointer; display:none;" class="close-btn">×</button>
        <div>
            <header>
                <img src="professional_headshot.jpg" alt="AM" onclick="window.location.hash='#profile-view'" style="width:80px; height:80px; object-fit:cover; margin-bottom:1.5rem; filter:grayscale(100%); cursor:pointer; transition:0.3s;" onmouseover="this.style.filter='grayscale(0%)'" onmouseout="this.style.filter='grayscale(100%)'">
                <h1 style="margin-bottom:0.5rem;">Alex MacMillan</h1>
                <span class="subtitle">Employment Law Barrister</span>
                <div style="font-size:0.8rem;">St Philips Barristers</div>
            </header>
            
            <nav style="margin-top: 3rem;">
                <div class="nav-section">
                    <span class="nav-label">Menu</span>
                    <nav class="sidebar-nav">
                        <a data-hash="#profile-view" class="nav-active" onclick="handleLinkClick(this)">Profile</a>
                        <a data-hash="#cases-view" onclick="handleLinkClick(this)">Case Database</a> 
                        <a data-hash="#articles-hub-view" onclick="handleLinkClick(this)">News & Insights</a>
                        <a href="https://www.st-philips.com/our_people/alexander-macmillan/" target="_blank">Chambers Profile ↗</a>
                    </nav>
                </div>

                <div class="nav-section">
                    <span class="nav-label">Tools</span>
                    <nav class="sidebar-nav">
                        <a data-hash="#limitation-view" onclick="handleLinkClick(this)">Limitation Calc</a>
                        <a data-hash="#notice-pay-view" onclick="handleLinkClick(this)">Notice Pay Calc</a>
                        <a data-hash="#holiday-pay-view" onclick="handleLinkClick(this)">Holiday Pay</a>
                        <a data-hash="#redundancy-pay-view" onclick="handleLinkClick(this)">Redundancy</a>
                        <a data-hash="#disciplinary-view" onclick="handleLinkClick(this)">Disciplinary Check</a>
                        <a data-hash="#pension-loss-view" onclick="handleLinkClick(this)">Simple & Complex Pension Loss Calc</a>
                        <a data-hash="#quantum-risk-view" onclick="handleLinkClick(this)">Quantum Risk Calc</a>
                    </nav>
                </div>
            </nav>
        </div>

        <div>
            <div class="nav-section">
                <span class="nav-label">Instruct</span>
                <a href="mailto:employment&pi@st-philips.com" class="contact-email">employment&pi@st-philips.com</a>
                <div style="font-size: 0.85rem; margin-top: 0.5rem; color: #666;">+44 (0) 121 246 7015</div>
                <a href="mailto:employment&pi@st-philips.com?subject=Enquiry%20for%20Alex%20MacMillan" 
                   style="display: block; margin-top: 1rem; text-decoration: underline; color: var(--text-main); font-size: 0.9rem;">
                   Email Clerks Direct →
                </a>
            </div>
            <div class="testimonial-box">"A superb and effective trial counsel."</div>
            <footer class="sidebar-footer" style="margin-top: 1rem;">&copy; 2025 Alex MacMillan</footer>
        </div>
    </aside>

    <main class="main-content">
        <div id="profile-view" class="page-view fade-in">
            <section id="about">
                <h2>Profile</h2>
                <p style="font-size: 1.4rem; font-family: var(--font-serif); line-height: 1.4;">
                    Specialist employment advocacy for complex disputes, focusing on discrimination, whistleblowing, TUPE, and cross-border issues.
                </p>
                <p>
                    Regularly instructed in high-value matters for financial institutions, retailers, and local authorities. Significant recent experience in the EAT, High Court, and Court of Appeal.
                </p>

                <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--line-color);">
                    <span class="nav-label">Background & Experience</span>
                    <ul class="content-list" style="max-width: none; list-style:none; padding:0; line-height:1.6; margin-top:1rem;">
                        <li style="margin-bottom:1rem;">
                            <strong>Speechwriter for the Japanese Ambassador to the OECD</strong><br>
                            <span style="color:#666; font-size:0.95rem;">Drafting high-level diplomatic correspondence and policy addresses.</span>
                        </li>
                        <li style="margin-bottom:1rem;">
                            <strong>Advocacy Officer, Legal Assistance Centre (Namibia)</strong><br>
                            <span style="color:#666; font-size:0.95rem;">Human rights advocacy and legal research in a challenging international context.</span>
                        </li>
                        <li style="margin-bottom:1rem;">
                            <strong>Director, Academic Publishing Company (2003–2013)</strong><br>
                            <span style="color:#666; font-size:0.95rem;">Managed operations and commercial strategy for a specialized publishing house.</span>
                        </li>
                    </ul>
                </div>
                
                <div id="home-latest-insight-container" style="margin-top: 3rem;"></div>
                
                <div class="testimonials-container">
                    <span class="nav-label" style="display:block; margin-bottom:1rem;">Client Feedback</span>
                    <div id="testimonials-wrapper" class="testimonials-wrapper"></div>
                    <div class="testimonial-controls">
                        <button class="control-btn" id="prev-testimonial">←</button>
                        <button class="control-btn" id="next-testimonial">→</button>
                    </div>
                </div>

                <div style="margin-top: 3rem; border-top: 1px solid var(--line-color); padding-top: 2rem;">
                     <span class="nav-label">Education</span>
                     <ul class="content-list" style="max-width: none; list-style:none; padding:0; line-height:1.8;">
                        <li><strong>BPTC</strong> – Inns of Court School of Law (The City Law School)</li>
                        <li><strong>GDL</strong> – University of Law</li>
                        <li>
                            <strong>PhD, MPhil</strong> – University of Cambridge<br>
                            <span style="color:#666; font-size:0.9rem;">Supervised by [Supervisor Name] | Thesis: "[Title of Thesis]"</span>
                        </li>
                        <li><strong>BA</strong> – University College London</li>
                     </ul>
                </div>
            </section>
        </div>

        <div id="cases-view" class="page-view fade-in" style="display:none;">
            <section id="notable-cases">
                <h2>Case Database</h2>
                <p>A searchable database of recent instructions covering the Employment Tribunal, EAT, High Court, and Court of Appeal.</p>

                <div id="knowledge-card-container" class="knowledge-card"></div>

                <div class="filters-toolbar">
                    <div class="filter-group">
                        <span class="nav-label">Keyword Search</span>
                        <input type="text" id="case-search-input" class="search-input" placeholder="e.g. 'Whistleblowing', 'Manchester'">
                    </div>
                    
                    <div class="filter-group">
                        <span class="nav-label">Practice Area</span>
                        <select id="case-type-filter" class="filter-select">
                            <option value="all">All Practice Areas</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <span class="nav-label">Instructing Firm</span>
                        <input type="text" id="case-solicitor-input" list="solicitor-datalist" class="autocomplete-input" placeholder="Type Firm Name...">
                        <datalist id="solicitor-datalist"></datalist>
                    </div>

                    <div class="filter-group">
                        <span class="nav-label">Judge</span>
                        <input type="text" id="case-judge-input" list="judges-datalist" class="autocomplete-input" placeholder="Type Judge's Name...">
                        <datalist id="judges-datalist"></datalist>
                    </div>

                    <div class="filter-group" style="flex-direction: row; align-items: center; gap: 0.5rem; min-width: 150px;">
                        <input type="checkbox" id="case-starred-filter" style="width: auto; margin: 0; cursor: pointer;">
                        <label for="case-starred-filter" style="font-size: 0.8rem; cursor: pointer; color: var(--text-main);">
                            <span class="help-tip" title="Shows starred cases from the last 3 years">Recent & Notable</span>
                        </label>
                    </div>

                    <button id="clear-filters-btn" class="clear-filters-btn">Reset ↺</button>
                    <div id="filter-count-display" style="font-family:var(--font-mono); font-size:0.8rem; color:#555; margin-left:1rem;"></div>
                </div>

                <div id="cases-list-container"></div>
                
                <div style="margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--line-color);">
                    <button id="generate-cases-report-btn" class="calc-button">Download Word Report (.docx)</button>
                </div>
            </section>
        </div>
        
        <div id="articles-hub-view" class="page-view fade-in" style="display:none; padding:4rem;">
            <h2>News & Insights</h2>
            <div id="articles-grid-container" class="article-grid"></div>
        </div>

        <div id="article-reader-view" class="page-view fade-in" style="display: none; padding:4rem;">
            <a href="javascript:void(0);" onclick="window.location.hash = '#articles-hub-view'" class="back-btn">← Index</a>
            <div id="article-reader-content"></div>
        </div>

        <div id="holiday-pay-view" class="page-view fade-in" style="display:none; padding:4rem;">
            <h2>Holiday Pay</h2>
            <p>For irregular-hours workers (52-week reference period estimate).</p>
            <div class="calculator-inputs" style="margin-top: 2rem;">
                <div class="calculator-grid">
                    <div><label>Total Gross Pay (52 weeks)</label><input type="number" id="hp-total-pay" placeholder="£"></div>
                    <div><label>Weeks Worked</label><input type="number" id="hp-weeks-worked" placeholder="e.g. 46"></div>
                </div>
                <button id="calculate-hp-btn" class="calc-button">Calculate</button>
            </div>
            <div id="hp-results" class="pay-result-box" style="display:none;"></div>
        </div>

        <div id="limitation-view" class="page-view fade-in" style="display:none; padding:4rem;"><h2>Limitation Calculator</h2><p>Tool loaded.</p></div>
        <div id="notice-pay-view" class="page-view fade-in" style="display:none; padding:4rem;"><h2>Notice Pay Calculator</h2><p>Tool loaded.</p></div>
        <div id="redundancy-pay-view" class="page-view fade-in" style="display:none; padding:4rem;"><h2>Redundancy Calculator</h2><p>Tool loaded.</p></div>
        <div id="disciplinary-view" class="page-view fade-in" style="display:none; padding:4rem;"><h2>Disciplinary Check</h2><p>Tool loaded.</p></div>
        <div id="pension-loss-view" class="page-view fade-in" style="display:none; height:100vh;"><iframe src="https://pensionloss-sfkjpwsy5kupvse623a3ko.streamlit.app/?embed=true" style="width:100%; height:100%; border:none;"></iframe></div>
        <div id="quantum-risk-view" class="page-view fade-in" style="display:none; height:100vh;"><iframe src="https://quantum-risk-tool.streamlit.app/?embed=true" style="width:100%; height:100%; border:none;"></iframe></div>

    </main>

    <button id="back-to-top" class="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">↑</button>

    <div id="cookie-banner" class="cookie-banner">
        <div class="cookie-text">
            We use cookies to improve your experience and analyze site traffic. By continuing to use this site, you agree to our use of cookies.
        </div>
        <div class="cookie-actions">
            <button class="cookie-btn" onclick="handleCookieConsent(false)">Decline</button>
            <button class="cookie-btn accept" onclick="handleCookieConsent(true)">Accept</button>
        </div>
    </div>
</div>

<script src="content.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        if (typeof CASES_DATA === 'undefined') {
            document.getElementById('cases-list-container').innerHTML = '<div style="color:red; padding:1rem;">Error: Data file (content.js) not loaded.</div>';
            return;
        }
        initCases();
        initPayCalculators();
        initTestimonialsCarousel();
        initScrollTools();
        initCookieBanner();
        renderArticlesHub(); // Populate teaser on home
        handleRoute();
    });

    // Navigation Logic
    window.addEventListener('hashchange', handleRoute);

    function handleLinkClick(element) {
        const target = element.getAttribute('data-hash');
        if(target) window.location.hash = target;
    }

    function handleRoute() {
        const hash = window.location.hash || '#profile-view';
        
        // 1. Check for Article ID
        if(typeof ARTICLES_DATA !== 'undefined') {
            const articleMatch = ARTICLES_DATA.find(a => '#' + a.id === hash);
            if (articleMatch) {
                openArticle(articleMatch.id);
                return;
            }
        }

        // 2. Hide all views
        document.querySelectorAll('.page-view').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.sidebar-nav a').forEach(el => el.classList.remove('nav-active'));
        
        // 3. Show Target
        const targetId = hash.replace('#', '');
        const targetEl = document.getElementById(targetId);
        if (targetEl) {
            targetEl.style.display = 'block';
            window.scrollTo(0,0);
        } else {
            // Default fallback
            document.getElementById('profile-view').style.display = 'block';
        }

        // 4. Highlight Link
        const activeLink = document.querySelector(`.sidebar-nav a[data-hash="#${targetId}"]`);
        if (activeLink) activeLink.classList.add('nav-active');
        
        document.getElementById('main-sidebar').classList.remove('mobile-open');
        document.getElementById('menu-overlay').classList.remove('active');
    }

    // --- FIX: MOBILE TOGGLE HELPER ---
    function toggleMobileMenu() {
        document.getElementById('main-sidebar').classList.toggle('mobile-open');
        document.getElementById('menu-overlay').classList.toggle('active');
    }

    // --- CASE LOGIC ---
    function initCases() {
        const typeFilter = document.getElementById('case-type-filter');
        const judgeInput = document.getElementById('case-judge-input');
        const solInput = document.getElementById('case-solicitor-input');
        const searchInput = document.getElementById('case-search-input');
        const starredFilter = document.getElementById('case-starred-filter');
        const clearBtn = document.getElementById('clear-filters-btn');

        const jurisSet = new Set();
        const judgeSet = new Set();
        const solSet = new Set();

        CASES_DATA.forEach(c => {
            if(c.jurisdiction) c.jurisdiction.forEach(j => jurisSet.add(j));
            if(c.judge && c.judge.length > 3) judgeSet.add(c.judge);
            if(c.solicitor) solSet.add(c.solicitor);
        });

        Array.from(jurisSet).sort().forEach(j => {
            const opt = document.createElement('option'); opt.value = j; opt.innerText = j; typeFilter.appendChild(opt);
        });
        
        const judgeList = document.getElementById('judges-datalist');
        Array.from(judgeSet).sort().forEach(j => { const opt = document.createElement('option'); opt.value = j; judgeList.appendChild(opt); });

        const solList = document.getElementById('solicitor-datalist');
        Array.from(solSet).sort().forEach(s => { const opt = document.createElement('option'); opt.value = s; solList.appendChild(opt); });

        typeFilter.addEventListener('change', renderCases);
        judgeInput.addEventListener('input', renderCases);
        solInput.addEventListener('input', renderCases);
        searchInput.addEventListener('keyup', renderCases);
        starredFilter.addEventListener('change', renderCases);
        clearBtn.addEventListener('click', clearFilters);

        renderCases();
    }

    function clearFilters() {
        document.getElementById('case-type-filter').value = 'all';
        document.getElementById('case-judge-input').value = '';
        document.getElementById('case-solicitor-input').value = '';
        document.getElementById('case-search-input').value = '';
        document.getElementById('case-starred-filter').checked = false;
        document.getElementById('knowledge-card-container').style.display = 'none';
        renderCases();
    }

    function closeKnowledgeCard() {
        document.getElementById('knowledge-card-container').style.display = 'none';
    }

    // SCROLL & TOOLS
    function initScrollTools() {
        const btn = document.getElementById('back-to-top');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 400) btn.classList.add('visible');
            else btn.classList.remove('visible');
        });
    }

    // COOKIE BANNER
    function initCookieBanner() {
        const consent = localStorage.getItem('cookieConsent');
        if (!consent) {
            setTimeout(() => {
                document.getElementById('cookie-banner').classList.add('active');
            }, 1000);
        }
    }

    window.handleCookieConsent = function(accepted) {
        localStorage.setItem('cookieConsent', accepted ? 'accepted' : 'declined');
        document.getElementById('cookie-banner').classList.remove('active');
    }

    window.copyCaseToClipboard = function(idx) {
        const c = CASES_DATA[idx];
        if(!c) return;
        
        const textToCopy = `RECOMMENDED COUNSEL:\nCase: ${c.title} (${c.year})\nJudge: ${c.judge}\nOutcome: ${c.description}\n`;
        
        navigator.clipboard.writeText(textToCopy).then(() => {
            const btn = document.getElementById(`copy-btn-${idx}`);
            const originalText = btn.innerHTML;
            btn.innerHTML = "✓ Copied!";
            btn.style.color = "green";
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.color = "";
            }, 2000);
        });
    }

    window.filterByBadge = function(type, value) {
        // Switch to case view if not already there
        if(window.location.hash !== '#cases-view') {
            window.location.hash = '#cases-view';
            setTimeout(() => applyFilter(type, value), 100);
        } else {
            applyFilter(type, value);
        }
    }

    function applyFilter(type, value) {
        clearFilters(); 
        if (type === 'jurisdiction') {
            document.getElementById('case-type-filter').value = value;
            if (typeof KNOWLEDGE_BASE !== 'undefined' && KNOWLEDGE_BASE[value]) {
                const card = document.getElementById('knowledge-card-container');
                card.innerHTML = `<button class="knowledge-card-close" onclick="closeKnowledgeCard()">×</button><h4>${KNOWLEDGE_BASE[value].title}</h4><p>${KNOWLEDGE_BASE[value].content}</p>`;
                card.style.display = 'block';
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        } else if (type === 'judge') {
            document.getElementById('case-judge-input').value = value;
        } else if (type === 'solicitor') {
            document.getElementById('case-solicitor-input').value = value;
        } else if (type === 'caselaw') {
            document.getElementById('case-search-input').value = value;
            if (typeof CASE_LAW_DICTIONARY !== 'undefined') {
                 let summary = CASE_LAW_DICTIONARY[value];
                 if (!summary) {
                     const key = Object.keys(CASE_LAW_DICTIONARY).find(k => value.includes(k));
                     if(key) summary = CASE_LAW_DICTIONARY[key];
                 }
                 if (summary) {
                    const card = document.getElementById('knowledge-card-container');
                    card.innerHTML = `<button class="knowledge-card-close" onclick="closeKnowledgeCard()">×</button><h4>${value}</h4><p>${summary}</p>`;
                    card.style.display = 'block';
                    card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                 }
            }
        }
        renderCases();
    }

    function renderCases() {
        const container = document.getElementById('cases-list-container');
        container.innerHTML = '';
        container.className = 'case-timeline';

        const typeVal = document.getElementById('case-type-filter').value;
        const judgeVal = document.getElementById('case-judge-input').value.toLowerCase();
        const solVal = document.getElementById('case-solicitor-input').value.toLowerCase();
        const searchVal = document.getElementById('case-search-input').value.toLowerCase();
        const starredVal = document.getElementById('case-starred-filter').checked;
        const currentYear = new Date().getFullYear();

        // Note: We need original index for the copy button, so we map first
        const matches = CASES_DATA.map((c, i) => ({data: c, index: i})).filter(item => {
            const c = item.data;
            const matchesType = (typeVal === 'all') || (c.jurisdiction && c.jurisdiction.includes(typeVal));
            const matchesJudge = !judgeVal || (c.judge && c.judge.toLowerCase().includes(judgeVal));
            const matchesSol = !solVal || (c.solicitor && c.solicitor.toLowerCase().includes(solVal));
            const text = `${c.title} ${c.description} ${c.court} ${c.citation}`.toLowerCase();
            const matchesSearch = !searchVal || text.includes(searchVal);
            
            let matchesStarred = true;
            if (starredVal) {
                const isRecent = (currentYear - (c.year || currentYear)) <= 3;
                matchesStarred = (c.starred === true) && isRecent;
            }

            return matchesType && matchesJudge && matchesSol && matchesSearch && matchesStarred;
        });

        document.getElementById('filter-count-display').innerText = `${matches.length} Case${matches.length !== 1 ? 's' : ''}`;

        if (matches.length === 0) {
            container.innerHTML = '<p style="color:#777; font-style:italic; padding:1rem;">No cases found matching filters.</p>';
            return;
        }

        matches.forEach(item => {
            const c = item.data;
            const idx = item.index;
            const div = document.createElement('div');
            const isFeatured = /Court of Appeal|High Court|EAT/i.test(c.court || '') || c.starred;
            div.className = isFeatured ? 'case-item case-item--featured' : 'case-item';

            let jurisBadges = (c.jurisdiction || []).map(j => 
                `<span class="case-tag jurisdiction-tag clickable-badge" onclick="filterByBadge('jurisdiction', '${j.replace(/'/g, "\\'")}')">${j}</span>`
            ).join(' ');

            let solBadge = (c.solicitor && c.solicitor.length > 1) ? 
                `<span class="case-tag clickable-badge" onclick="filterByBadge('solicitor', '${c.solicitor.replace(/'/g, "\\'")}')"><strong>Firm:</strong> ${c.solicitor}</span>` : '';

            let caseLawHtml = '';
            if(c.key_case_law && c.key_case_law.length > 0) {
                const badges = c.key_case_law.map(law => {
                    const temp = document.createElement("div"); temp.innerHTML = law;
                    const plainText = (temp.textContent || temp.innerText || "").trim();
                    let summary = null;
                    if (typeof CASE_LAW_DICTIONARY !== 'undefined') {
                        summary = CASE_LAW_DICTIONARY[plainText];
                        if (!summary) {
                            const key = Object.keys(CASE_LAW_DICTIONARY).find(k => plainText.includes(k));
                            if(key) summary = CASE_LAW_DICTIONARY[key];
                        }
                    }
                    const tooltip = summary ? `<span class="case-tooltip-popup">${summary}</span>` : '';
                    const style = summary ? 'border-bottom:1px dotted #e65100; cursor: help;' : '';

                    return `<span class="case-tag clickable-badge law-tag" style="font-style:italic; ${style}" onclick="filterByBadge('caselaw', '${plainText.replace(/'/g, "\\'")}')">${law}${tooltip}</span>`;
                }).join('');
                
                caseLawHtml = `<div class="case-law-section"><span class="case-law-label">Key Authorities (Hover or Click for summary)</span><div class="case-badges-row" style="margin-top:0;">${badges}</div></div>`;
            }

            const judgeHtml = c.judge 
                ? `<div class="case-meta clickable-meta" onclick="filterByBadge('judge', '${c.judge.replace(/'/g, "\\'")}')" title="Filter cases heard by ${c.judge}">${c.judge}</div>`
                : '';

            div.innerHTML = `
                <div class="case-node"></div>
                <div class="case-year-label">${c.year}</div>
                <div class="case-header">
                    <div>
                        <h3 class="case-title">${c.title}</h3>
                        <div class="case-strapline">${c.citation || ''}</div>
                    </div>
                    <div class="case-meta-block">
                        <div class="case-meta">${c.court || ''}</div>
                        ${judgeHtml}
                    </div>
                </div>
                <p>${c.description}</p>
                ${caseLawHtml}
                <div class="case-badges-row" style="margin-top:1.25rem;">
                    ${solBadge}
                    ${jurisBadges}
                    <button class="copy-btn" id="copy-btn-${idx}" onclick="copyCaseToClipboard(${idx})" title="Copy case summary for client email">
                        <span>Copy Summary</span>
                    </button>
                </div>
            `;
            container.appendChild(div);
        });
    }

    // --- ARTICLES ---
    function renderArticlesHub() {
        const container = document.getElementById('articles-grid-container');
        if(container) {
            container.innerHTML = '';
            if (typeof ARTICLES_DATA !== 'undefined') {
                ARTICLES_DATA.forEach(a => {
                    container.innerHTML += `
                        <div class="article-card" onclick="window.location.hash='#${a.id}'">
                            <h3>${a.title}</h3>
                            <div class="article-date">${a.date}</div>
                            <p style="font-size:0.9rem; color:#555;">${a.summary}</p>
                            <span class="read-more-link">Read Entry →</span>
                        </div>`;
                });
            }
        }
        const teaserContainer = document.getElementById('home-latest-insight-container');
        if(teaserContainer && typeof ARTICLES_DATA !== 'undefined' && ARTICLES_DATA.length > 0) {
            const latest = ARTICLES_DATA.slice(0, 3);
            let html = '<h3 style="margin-bottom:1rem; border-bottom:none; color:var(--text-muted); font-size:1rem; text-transform:uppercase; letter-spacing:0.05em;">Recent Updates</h3>';
            html += '<div class="article-grid" style="border-top:1px solid var(--line-color); border-left:1px solid var(--line-color);">';
            latest.forEach(a => {
                html += `
                    <div class="article-card" style="border:none; border-right:1px solid var(--line-color); border-bottom:1px solid var(--line-color); margin:0;" onclick="window.location.hash='#${a.id}'">
                        <span class="article-date">${a.date}</span>
                        <h3 style="font-size:1.3rem; margin:0.5rem 0;">${a.title}</h3>
                        <p style="font-size:0.9rem; color:#444;">${a.summary}</p>
                        <span class="read-more-link">Read Full Article →</span>
                    </div>
                `;
            });
            html += '</div>';
            teaserContainer.innerHTML = html;
        }
    }

    function openArticle(id) {
        const article = ARTICLES_DATA.find(a => a.id === id);
        if (!article) return;
        document.getElementById('article-reader-content').innerHTML = `<h1>${article.title}</h1><div class="subtitle">${article.date}</div>${article.content}`;
        document.querySelectorAll('.page-view').forEach(el => el.style.display = 'none');
        document.getElementById('article-reader-view').style.display = 'block';
        window.scrollTo(0,0);
    }

    // --- TESTIMONIALS ---
    function initTestimonialsCarousel() {
        const wrapper = document.getElementById('testimonials-wrapper');
        const prevBtn = document.getElementById('prev-testimonial');
        const nextBtn = document.getElementById('next-testimonial');
        if (!wrapper || typeof TESTIMONIALS_DATA === 'undefined') return;
        let currentIndex = 0;
        function render() {
            wrapper.innerHTML = '';
            TESTIMONIALS_DATA.forEach(t => {
                const slide = document.createElement('div');
                slide.className = 'testimonial-slide';
                slide.innerHTML = `<div class="testimonial-text">"${t.text}"</div><div class="testimonial-author">— ${t.author}, ${t.firm}</div>`;
                wrapper.appendChild(slide);
            });
            update();
        }
        function update() { wrapper.style.transform = `translateX(-${currentIndex * 100}%)`; }
        nextBtn.addEventListener('click', () => { currentIndex = (currentIndex + 1) % TESTIMONIALS_DATA.length; update(); });
        prevBtn.addEventListener('click', () => { currentIndex = (currentIndex - 1 + TESTIMONIALS_DATA.length) % TESTIMONIALS_DATA.length; update(); });
        render();
    }

    // --- CALCULATORS ---
    function initPayCalculators() {
        const hpBtn = document.getElementById('calculate-hp-btn');
        if(hpBtn) hpBtn.addEventListener('click', calculateHolidayPay);
    }

    function calculateHolidayPay() {
        const total = parseFloat(document.getElementById('hp-total-pay').value);
        const weeks = parseFloat(document.getElementById('hp-weeks-worked').value);
        const resDiv = document.getElementById('hp-results');
        if (isNaN(total) || isNaN(weeks) || weeks <= 0) {
            resDiv.innerHTML = '<div class="error-message">Invalid input</div>';
            resDiv.style.display = 'block';
            return;
        }
        const avg = total / weeks;
        const ent = avg * 5.6;
        resDiv.innerHTML = `<div class="result-headline">£${ent.toFixed(2)}</div><p>Based on avg weekly pay £${avg.toFixed(2)}</p>`;
        resDiv.style.display = 'block';
    }
</script>

</body>
</html>
